878e266ace5f06a6d3fd52d3f77720b2










'use strict';

var invariant = require('fbjs/lib/invariant');

var TRACE_TAG_REACT_APPS = 1 << 17;
var TRACE_TAG_JS_VM_CALLS = 1 << 27;

var _enabled = false;
var _asyncCookie = 0;
var _markStack = [];
var _markStackIndex = -1;
var _canInstallReactHook = false;



var REACT_MARKER = '\u269B';
var userTimingPolyfill = __DEV__ ?
{
  mark: function mark(markName) {
    if (_enabled) {
      _markStackIndex++;
      _markStack[_markStackIndex] = markName;
      var systraceLabel = markName;


      if (markName[0] === REACT_MARKER) {


        var indexOfId = markName.lastIndexOf(' (#');
        var cutoffIndex = indexOfId !== -1 ? indexOfId : markName.length;

        systraceLabel = markName.slice(2, cutoffIndex);
      }
      Systrace.beginEvent(systraceLabel);
    }
  },
  measure: function measure(measureName, startMark, endMark) {
    if (_enabled) {
      invariant(
      typeof measureName === 'string' &&
      typeof startMark === 'string' &&
      typeof endMark === 'undefined',
      'Only performance.measure(string, string) overload is supported.');

      var topMark = _markStack[_markStackIndex];
      invariant(
      startMark === topMark,
      'There was a mismatching performance.measure() call. ' +
      'Expected "%s" but got "%s."',
      topMark,
      startMark);

      _markStackIndex--;


      Systrace.endEvent();
    }
  },
  clearMarks: function clearMarks(markName) {
    if (_enabled) {
      if (_markStackIndex === -1) {
        return;
      }
      if (markName === _markStack[_markStackIndex]) {


        if (userTimingPolyfill != null) {
          userTimingPolyfill.measure(markName, markName);
        }
      }
    }
  },
  clearMeasures: function clearMeasures() {


  } } :

null;

var Systrace = {
  installReactHook: function installReactHook() {
    if (_enabled) {
      if (__DEV__) {
        global.performance = userTimingPolyfill;
      }
    }
    _canInstallReactHook = true;
  },

  setEnabled: function setEnabled(enabled) {
    if (_enabled !== enabled) {
      if (__DEV__) {
        if (enabled) {
          global.nativeTraceBeginLegacy &&
          global.nativeTraceBeginLegacy(TRACE_TAG_JS_VM_CALLS);
        } else {
          global.nativeTraceEndLegacy &&
          global.nativeTraceEndLegacy(TRACE_TAG_JS_VM_CALLS);
        }
        if (_canInstallReactHook) {
          if (enabled && global.performance === undefined) {
            global.performance = userTimingPolyfill;
          }
        }
      }
      _enabled = enabled;
    }
  },

  isEnabled: function isEnabled() {
    return _enabled;
  },




  beginEvent: function beginEvent(profileName, args) {
    if (_enabled) {
      profileName =
      typeof profileName === 'function' ? profileName() : profileName;
      global.nativeTraceBeginSection(TRACE_TAG_REACT_APPS, profileName, args);
    }
  },

  endEvent: function endEvent() {
    if (_enabled) {
      global.nativeTraceEndSection(TRACE_TAG_REACT_APPS);
    }
  },






  beginAsyncEvent: function beginAsyncEvent(profileName) {
    var cookie = _asyncCookie;
    if (_enabled) {
      _asyncCookie++;
      profileName =
      typeof profileName === 'function' ? profileName() : profileName;
      global.nativeTraceBeginAsyncSection(
      TRACE_TAG_REACT_APPS,
      profileName,
      cookie);

    }
    return cookie;
  },

  endAsyncEvent: function endAsyncEvent(profileName, cookie) {
    if (_enabled) {
      profileName =
      typeof profileName === 'function' ? profileName() : profileName;
      global.nativeTraceEndAsyncSection(
      TRACE_TAG_REACT_APPS,
      profileName,
      cookie);

    }
  },




  counterEvent: function counterEvent(profileName, value) {
    if (_enabled) {
      profileName =
      typeof profileName === 'function' ? profileName() : profileName;
      global.nativeTraceCounter &&
      global.nativeTraceCounter(TRACE_TAG_REACT_APPS, profileName, value);
    }
  } };


if (__DEV__) {




  require.Systrace = Systrace;
}

module.exports = Systrace;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN5c3RyYWNlLmpzIl0sIm5hbWVzIjpbImludmFyaWFudCIsInJlcXVpcmUiLCJUUkFDRV9UQUdfUkVBQ1RfQVBQUyIsIlRSQUNFX1RBR19KU19WTV9DQUxMUyIsIl9lbmFibGVkIiwiX2FzeW5jQ29va2llIiwiX21hcmtTdGFjayIsIl9tYXJrU3RhY2tJbmRleCIsIl9jYW5JbnN0YWxsUmVhY3RIb29rIiwiUkVBQ1RfTUFSS0VSIiwidXNlclRpbWluZ1BvbHlmaWxsIiwiX19ERVZfXyIsIm1hcmsiLCJtYXJrTmFtZSIsInN5c3RyYWNlTGFiZWwiLCJpbmRleE9mSWQiLCJsYXN0SW5kZXhPZiIsImN1dG9mZkluZGV4IiwibGVuZ3RoIiwic2xpY2UiLCJTeXN0cmFjZSIsImJlZ2luRXZlbnQiLCJtZWFzdXJlIiwibWVhc3VyZU5hbWUiLCJzdGFydE1hcmsiLCJlbmRNYXJrIiwidG9wTWFyayIsImVuZEV2ZW50IiwiY2xlYXJNYXJrcyIsImNsZWFyTWVhc3VyZXMiLCJpbnN0YWxsUmVhY3RIb29rIiwiZ2xvYmFsIiwicGVyZm9ybWFuY2UiLCJzZXRFbmFibGVkIiwiZW5hYmxlZCIsIm5hdGl2ZVRyYWNlQmVnaW5MZWdhY3kiLCJuYXRpdmVUcmFjZUVuZExlZ2FjeSIsInVuZGVmaW5lZCIsImlzRW5hYmxlZCIsInByb2ZpbGVOYW1lIiwiYXJncyIsIm5hdGl2ZVRyYWNlQmVnaW5TZWN0aW9uIiwibmF0aXZlVHJhY2VFbmRTZWN0aW9uIiwiYmVnaW5Bc3luY0V2ZW50IiwiY29va2llIiwibmF0aXZlVHJhY2VCZWdpbkFzeW5jU2VjdGlvbiIsImVuZEFzeW5jRXZlbnQiLCJuYXRpdmVUcmFjZUVuZEFzeW5jU2VjdGlvbiIsImNvdW50ZXJFdmVudCIsInZhbHVlIiwibmF0aXZlVHJhY2VDb3VudGVyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQVVBOztBQUVBLElBQU1BLFlBQVlDLFFBQVEsb0JBQVIsQ0FBbEI7O0FBRUEsSUFB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Q0EsYUFBcEMsR0FBb0RBLFdBRHREO0FBRUFSLGFBQU9tQixrQkFBUDtBQUNFbkIsYUFBT21CLGtCQUFQLENBQTBCaEQsb0JBQTFCLEVBQWdEcUMsV0FBaEQsRUFBNkRVLEtBQTdELENBREY7QUFFRDtBQUNGLEdBN0ZjLEVBQWpCOzs7QUFnR0EsSUFBSXRDLE9BQUosRUFBYTs7Ozs7QUFLVlYsU0FBRCxDQUFlbUIsUUFBZixHQUEwQkEsUUFBMUI7QUFDRDs7QUFFRCtCLE9BQU9DLE9BQVAsR0FBaUJoQyxRQUFqQiIsImZpbGUiOiJTeXN0cmFjZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuXG5jb25zdCBUUkFDRV9UQUdfUkVBQ1RfQVBQUyA9IDEgPDwgMTc7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tYml0d2lzZVxuY29uc3QgVFJBQ0VfVEFHX0pTX1ZNX0NBTExTID0gMSA8PCAyNzsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1iaXR3aXNlXG5cbmxldCBfZW5hYmxlZCA9IGZhbHNlO1xubGV0IF9hc3luY0Nvb2tpZSA9IDA7XG5jb25zdCBfbWFya1N0YWNrID0gW107XG5sZXQgX21hcmtTdGFja0luZGV4ID0gLTE7XG5sZXQgX2Nhbkluc3RhbGxSZWFjdEhvb2sgPSBmYWxzZTtcblxuLy8gSW1wbGVtZW50cyBhIHN1YnNldCBvZiBVc2VyIFRpbWluZyBBUEkgbmVjZXNzYXJ5IGZvciBSZWFjdCBtZWFzdXJlbWVudHMuXG4vLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvVXNlcl9UaW1pbmdfQVBJXG5jb25zdCBSRUFDVF9NQVJLRVIgPSAnXFx1MjY5Qic7XG5jb25zdCB1c2VyVGltaW5nUG9seWZpbGwgPSBfX0RFVl9fXG4gID8ge1xuICAgICAgbWFyayhtYXJrTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGlmIChfZW5hYmxlZCkge1xuICAgICAgICAgIF9tYXJrU3RhY2tJbmRleCsrO1xuICAgICAgICAgIF9tYXJrU3RhY2tbX21hcmtTdGFja0luZGV4XSA9IG1hcmtOYW1lO1xuICAgICAgICAgIGxldCBzeXN0cmFjZUxhYmVsID0gbWFya05hbWU7XG4gICAgICAgICAgLy8gU2luY2UgcGVyZiBtZWFzdXJlbWVudHMgYXJlIGEgc2hhcmVkIG5hbWVzcGFjZSBpbiBVc2VyIFRpbWluZyBBUEksXG4gICAgICAgICAgLy8gd2UgcHJlZml4IGFsbCBSZWFjdCByZXN1bHRzIHdpdGggYSBSZWFjdCBlbW9qaS5cbiAgICAgICAgICBpZiAobWFya05hbWVbMF0gPT09IFJFQUNUX01BUktFUikge1xuICAgICAgICAgICAgLy8gVGhpcyBpcyBjb21pbmcgZnJvbSBSZWFjdC5cbiAgICAgICAgICAgIC8vIFJlbW92aW5nIGNvbXBvbmVudCBJRHMga2VlcHMgdHJhY2UgY29sb3JzIHN0YWJsZS5cbiAgICAgICAgICAgIGNvbnN0IGluZGV4T2ZJZCA9IG1hcmtOYW1lLmxhc3RJbmRleE9mKCcgKCMnKTtcbiAgICAgICAgICAgIGNvbnN0IGN1dG9mZkluZGV4ID0gaW5kZXhPZklkICE9PSAtMSA/IGluZGV4T2ZJZCA6IG1hcmtOYW1lLmxlbmd0aDtcbiAgICAgICAgICAgIC8vIEFsc28gY3V0IG9mZiB0aGUgZW1vamkgYmVjYXVzZSBpdCBicmVha3MgU3lzdHJhY2VcbiAgICAgICAgICAgIHN5c3RyYWNlTGFiZWwgPSBtYXJrTmFtZS5zbGljZSgyLCBjdXRvZmZJbmRleCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoc3lzdHJhY2VMYWJlbCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBtZWFzdXJlKG1lYXN1cmVOYW1lOiBzdHJpbmcsIHN0YXJ0TWFyazogP3N0cmluZywgZW5kTWFyazogP3N0cmluZykge1xuICAgICAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgICAgICBpbnZhcmlhbnQoXG4gICAgICAgICAgICB0eXBlb2YgbWVhc3VyZU5hbWUgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICAgIHR5cGVvZiBzdGFydE1hcmsgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICAgIHR5cGVvZiBlbmRNYXJrID09PSAndW5kZWZpbmVkJyxcbiAgICAgICAgICAgICdPbmx5IHBlcmZvcm1hbmNlLm1lYXN1cmUoc3RyaW5nLCBzdHJpbmcpIG92ZXJsb2FkIGlzIHN1cHBvcnRlZC4nLFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgdG9wTWFyayA9IF9tYXJrU3RhY2tbX21hcmtTdGFja0luZGV4XTtcbiAgICAgICAgICBpbnZhcmlhbnQoXG4gICAgICAgICAgICBzdGFydE1hcmsgPT09IHRvcE1hcmssXG4gICAgICAgICAgICAnVGhlcmUgd2FzIGEgbWlzbWF0Y2hpbmcgcGVyZm9ybWFuY2UubWVhc3VyZSgpIGNhbGwuICcgK1xuICAgICAgICAgICAgICAnRXhwZWN0ZWQgXCIlc1wiIGJ1dCBnb3QgXCIlcy5cIicsXG4gICAgICAgICAgICB0b3BNYXJrLFxuICAgICAgICAgICAgc3RhcnRNYXJrLFxuICAgICAgICAgICk7XG4gICAgICAgICAgX21hcmtTdGFja0luZGV4LS07XG4gICAgICAgICAgLy8gV2UgY2FuJ3QgdXNlIG1vcmUgZGVzY3JpcHRpdmUgbWVhc3VyZU5hbWUgYmVjYXVzZSBTeXN0cmFjZSBkb2Vzbid0XG4gICAgICAgICAgLy8gbGV0IHVzIGVkaXQgbGFiZWxzIHBvc3QgZmFjdHVtLlxuICAgICAgICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjbGVhck1hcmtzKG1hcmtOYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICAgICAgaWYgKF9tYXJrU3RhY2tJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1hcmtOYW1lID09PSBfbWFya1N0YWNrW19tYXJrU3RhY2tJbmRleF0pIHtcbiAgICAgICAgICAgIC8vIFJlYWN0IHVzZXMgdGhpcyBmb3IgXCJjYW5jZWxsaW5nXCIgc3RhcnRlZCBtZWFzdXJlbWVudHMuXG4gICAgICAgICAgICAvLyBTeXN0cmFjZSBkb2Vzbid0IHN1cHBvcnQgZGVsZXRpbmcgbWVhc3VyZW1lbnRzLCBzbyB3ZSBqdXN0IHN0b3AgdGhlbS5cbiAgICAgICAgICAgIGlmICh1c2VyVGltaW5nUG9seWZpbGwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICB1c2VyVGltaW5nUG9seWZpbGwubWVhc3VyZShtYXJrTmFtZSwgbWFya05hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNsZWFyTWVhc3VyZXMoKSB7XG4gICAgICAgIC8vIFJlYWN0IGNhbGxzIHRoaXMgdG8gYXZvaWQgbWVtb3J5IGxlYWtzIGluIGJyb3dzZXJzLCBidXQgd2UgZG9uJ3Qga2VlcFxuICAgICAgICAvLyBtZWFzdXJlbWVudHMgYW55d2F5LlxuICAgICAgfSxcbiAgICB9XG4gIDogbnVsbDtcblxuY29uc3QgU3lzdHJhY2UgPSB7XG4gIGluc3RhbGxSZWFjdEhvb2soKSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBpZiAoX19ERVZfXykge1xuICAgICAgICBnbG9iYWwucGVyZm9ybWFuY2UgPSB1c2VyVGltaW5nUG9seWZpbGw7XG4gICAgICB9XG4gICAgfVxuICAgIF9jYW5JbnN0YWxsUmVhY3RIb29rID0gdHJ1ZTtcbiAgfSxcblxuICBzZXRFbmFibGVkKGVuYWJsZWQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoX2VuYWJsZWQgIT09IGVuYWJsZWQpIHtcbiAgICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICAgIGlmIChlbmFibGVkKSB7XG4gICAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5MZWdhY3kgJiZcbiAgICAgICAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUJlZ2luTGVnYWN5KFRSQUNFX1RBR19KU19WTV9DQUxMUyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlRW5kTGVnYWN5ICYmXG4gICAgICAgICAgICBnbG9iYWwubmF0aXZlVHJhY2VFbmRMZWdhY3koVFJBQ0VfVEFHX0pTX1ZNX0NBTExTKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX2Nhbkluc3RhbGxSZWFjdEhvb2spIHtcbiAgICAgICAgICBpZiAoZW5hYmxlZCAmJiBnbG9iYWwucGVyZm9ybWFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZ2xvYmFsLnBlcmZvcm1hbmNlID0gdXNlclRpbWluZ1BvbHlmaWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgX2VuYWJsZWQgPSBlbmFibGVkO1xuICAgIH1cbiAgfSxcblxuICBpc0VuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIF9lbmFibGVkO1xuICB9LFxuXG4gIC8qKlxuICAgKiBiZWdpbkV2ZW50L2VuZEV2ZW50IGZvciBzdGFydGluZyBhbmQgdGhlbiBlbmRpbmcgYSBwcm9maWxlIHdpdGhpbiB0aGUgc2FtZSBjYWxsIHN0YWNrIGZyYW1lXG4gICAqKi9cbiAgYmVnaW5FdmVudChwcm9maWxlTmFtZT86IGFueSwgYXJncz86IGFueSkge1xuICAgIGlmIChfZW5hYmxlZCkge1xuICAgICAgcHJvZmlsZU5hbWUgPVxuICAgICAgICB0eXBlb2YgcHJvZmlsZU5hbWUgPT09ICdmdW5jdGlvbicgPyBwcm9maWxlTmFtZSgpIDogcHJvZmlsZU5hbWU7XG4gICAgICBnbG9iYWwubmF0aXZlVHJhY2VCZWdpblNlY3Rpb24oVFJBQ0VfVEFHX1JFQUNUX0FQUFMsIHByb2ZpbGVOYW1lLCBhcmdzKTtcbiAgICB9XG4gIH0sXG5cbiAgZW5kRXZlbnQoKSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBnbG9iYWwubmF0aXZlVHJhY2VFbmRTZWN0aW9uKFRSQUNFX1RBR19SRUFDVF9BUFBTKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIGJlZ2luQXN5bmNFdmVudC9lbmRBc3luY0V2ZW50IGZvciBzdGFydGluZyBhbmQgdGhlbiBlbmRpbmcgYSBwcm9maWxlIHdoZXJlIHRoZSBlbmQgY2FuIGVpdGhlclxuICAgKiBvY2N1ciBvbiBhbm90aGVyIHRocmVhZCBvciBvdXQgb2YgdGhlIGN1cnJlbnQgc3RhY2sgZnJhbWUsIGVnIGF3YWl0XG4gICAqIHRoZSByZXR1cm5lZCBjb29raWUgdmFyaWFibGUgc2hvdWxkIGJlIHVzZWQgYXMgaW5wdXQgaW50byB0aGUgZW5kQXN5bmNFdmVudCBjYWxsIHRvIGVuZCB0aGUgcHJvZmlsZVxuICAgKiovXG4gIGJlZ2luQXN5bmNFdmVudChwcm9maWxlTmFtZT86IGFueSk6IGFueSB7XG4gICAgY29uc3QgY29va2llID0gX2FzeW5jQ29va2llO1xuICAgIGlmIChfZW5hYmxlZCkge1xuICAgICAgX2FzeW5jQ29va2llKys7XG4gICAgICBwcm9maWxlTmFtZSA9XG4gICAgICAgIHR5cGVvZiBwcm9maWxlTmFtZSA9PT0gJ2Z1bmN0aW9uJyA/IHByb2ZpbGVOYW1lKCkgOiBwcm9maWxlTmFtZTtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUJlZ2luQXN5bmNTZWN0aW9uKFxuICAgICAgICBUUkFDRV9UQUdfUkVBQ1RfQVBQUyxcbiAgICAgICAgcHJvZmlsZU5hbWUsXG4gICAgICAgIGNvb2tpZSxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBjb29raWU7XG4gIH0sXG5cbiAgZW5kQXN5bmNFdmVudChwcm9maWxlTmFtZT86IGFueSwgY29va2llPzogYW55KSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBwcm9maWxlTmFtZSA9XG4gICAgICAgIHR5cGVvZiBwcm9maWxlTmFtZSA9PT0gJ2Z1bmN0aW9uJyA/IHByb2ZpbGVOYW1lKCkgOiBwcm9maWxlTmFtZTtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUVuZEFzeW5jU2VjdGlvbihcbiAgICAgICAgVFJBQ0VfVEFHX1JFQUNUX0FQUFMsXG4gICAgICAgIHByb2ZpbGVOYW1lLFxuICAgICAgICBjb29raWUsXG4gICAgICApO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogY291bnRlckV2ZW50IHJlZ2lzdGVycyB0aGUgdmFsdWUgdG8gdGhlIHByb2ZpbGVOYW1lIG9uIHRoZSBzeXN0cmFjZSB0aW1lbGluZVxuICAgKiovXG4gIGNvdW50ZXJFdmVudChwcm9maWxlTmFtZT86IGFueSwgdmFsdWU/OiBhbnkpIHtcbiAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgIHByb2ZpbGVOYW1lID1cbiAgICAgICAgdHlwZW9mIHByb2ZpbGVOYW1lID09PSAnZnVuY3Rpb24nID8gcHJvZmlsZU5hbWUoKSA6IHByb2ZpbGVOYW1lO1xuICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQ291bnRlciAmJlxuICAgICAgICBnbG9iYWwubmF0aXZlVHJhY2VDb3VudGVyKFRSQUNFX1RBR19SRUFDVF9BUFBTLCBwcm9maWxlTmFtZSwgdmFsdWUpO1xuICAgIH1cbiAgfSxcbn07XG5cbmlmIChfX0RFVl9fKSB7XG4gIC8vIFRoaXMgaXMgbmVlZGVkLCBiZWNhdXNlIHJlcXVpcmUgY2FsbGlzIGluIHBvbHlmaWxscyBhcmUgbm90IHByb2Nlc3NlZCBhc1xuICAvLyBvdGhlciBmaWxlcy4gVGhlcmVmb3JlLCBjYWxscyB0byBgcmVxdWlyZSgnbW9kdWxlSWQnKWAgYXJlIG5vdCByZXBsYWNlZFxuICAvLyB3aXRoIG51bWVyaWMgSURzXG4gIC8vIFRPRE8oZGF2aWRhdXJlbGlvKSBTY2FuIHBvbHlmaWxscyBmb3IgZGVwZW5kZW5jaWVzLCB0b28gKHQ5NzU5Njg2KVxuICAocmVxdWlyZTogYW55KS5TeXN0cmFjZSA9IFN5c3RyYWNlO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFN5c3RyYWNlO1xuIl19