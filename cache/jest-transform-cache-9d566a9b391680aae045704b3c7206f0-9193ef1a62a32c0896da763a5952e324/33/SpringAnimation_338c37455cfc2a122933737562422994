23e65ec2303ff9a60b3abbd232311eb2









'use strict';var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _get = function get(object, property, receiver) {if (object === null) object = Function.prototype;var desc = Object.getOwnPropertyDescriptor(object, property);if (desc === undefined) {var parent = Object.getPrototypeOf(object);if (parent === null) {return undefined;} else {return get(parent, property, receiver);}} else if ("value" in desc) {return desc.value;} else {var getter = desc.get;if (getter === undefined) {return undefined;}return getter.call(receiver);}};function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self, call) {if (!self) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call && (typeof call === "object" || typeof call === "function") ? call : self;}function _inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;}

var AnimatedValue = require('../nodes/AnimatedValue');
var AnimatedValueXY = require('../nodes/AnimatedValueXY');
var Animation = require('./Animation');
var SpringConfig = require('../SpringConfig');

var invariant = require('fbjs/lib/invariant');var _require =
require('../NativeAnimatedHelper'),shouldUseNativeDriver = _require.shouldUseNativeDriver;



































function withDefault(value, defaultValue) {
  if (value === undefined || value === null) {
    return defaultValue;
  }
  return value;
}var

SpringAnimation = function (_Animation) {_inherits(SpringAnimation, _Animation);





















  function SpringAnimation(config) {_classCallCheck(this, SpringAnimation);var _this = _possibleConstructorReturn(this, (SpringAnimation.__proto__ || Object.getPrototypeOf(SpringAnimation)).call(this));


    _this._overshootClamping = withDefault(config.overshootClamping, false);
    _this._restDisplacementThreshold = withDefault(
    config.restDisplacementThreshold,
    0.001);

    _this._restSpeedThreshold = withDefault(config.restSpeedThreshold, 0.001);
    _this._initialVelocity = withDefault(config.velocity, 0);
    _this._lastVelocity = withDefault(config.velocity, 0);
    _this._toValue = config.toValue;
    _this._delay = withDefault(config.delay, 0);
    _this._useNativeDriver = shouldUseNativeDriver(config);
    _this.__isInteraction =
    config.isInteraction !== undefined ? config.isInteraction : true;
    _this.__iterations = config.iterations !== undefined ? config.iterations : 1;

    if (
    config.stiffness !== undefined ||
    config.damping !== undefined ||
    config.mass !== undefined)
    {
      invariant(
      config.bounciness === undefined &&
      config.speed === undefined &&
      config.tension === undefined &&
      config.friction === undefined,
      'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');

      _this._stiffness = withDefault(config.stiffness, 100);
      _this._damping = withDefault(config.damping, 10);
      _this._mass = withDefault(config.mass, 1);
    } else if (config.bounciness !== undefined || config.speed !== undefined) {


      invariant(
      config.tension === undefined &&
      config.friction === undefined &&
      config.stiffness === undefined &&
      config.damping === undefined &&
      config.mass === undefined,
      'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');

      var springConfig = SpringConfig.fromBouncinessAndSpeed(
      withDefault(config.bounciness, 8),
      withDefault(config.speed, 12));

      _this._stiffness = springConfig.stiffness;
      _this._damping = springConfig.damping;
      _this._mass = 1;
    } else {


      var _springConfig = SpringConfig.fromOrigamiTensionAndFriction(
      withDefault(config.tension, 40),
      withDefault(config.friction, 7));

      _this._stiffness = _springConfig.stiffness;
      _this._damping = _springConfig.damping;
      _this._mass = 1;
    }

    invariant(_this._stiffness > 0, 'Stiffness value must be greater than 0');
    invariant(_this._damping > 0, 'Damping value must be greater than 0');
    invariant(_this._mass > 0, 'Mass value must be greater than 0');return _this;
  }_createClass(SpringAnimation, [{ key: '__getNativeAnimationConfig', value: function __getNativeAnimationConfig()

    {
      return {
        type: 'spring',
        overshootClamping: this._overshootClamping,
        restDisplacementThreshold: this._restDisplacementThreshold,
        restSpeedThreshold: this._restSpeedThreshold,
        stiffness: this._stiffness,
        damping: this._damping,
        mass: this._mass,
        initialVelocity: withDefault(this._initialVelocity, this._lastVelocity),
        toValue: this._toValue,
        iterations: this.__iterations };

    } }, { key: 'start', value: function start(


    fromValue,
    onUpdate,
    onEnd,
    previousAnimation,
    animatedValue)
    {var _this2 = this;
      this.__active = true;
      this._startPosition = fromValue;
      this._lastPosition = this._startPosition;

      this._onUpdate = onUpdate;
      this.__onEnd = onEnd;
      this._lastTime = Date.now();
      this._frameTime = 0.0;

      if (previousAnimation instanceof SpringAnimation) {
        var internalState = previousAnimation.getInternalState();
        this._lastPosition = internalState.lastPosition;
        this._lastVelocity = internalState.lastVelocity;

        this._initialVelocity = this._lastVelocity;
        this._lastTime = internalState.lastTime;
      }

      var start = function start() {
        if (_this2._useNativeDriver) {
          _this2.__startNativeAnimation(animatedValue);
        } else {
          _this2.onUpdate();
        }
      };


      if (this._delay) {
        this._timeout = setTimeout(start, this._delay);
      } else {
        start();
      }
    } }, { key: 'getInternalState', value: function getInternalState()

    {
      return {
        lastPosition: this._lastPosition,
        lastVelocity: this._lastVelocity,
        lastTime: this._lastTime };

    } }, { key: 'onUpdate', value: function onUpdate()






















    {




      var MAX_STEPS = 64;
      var now = Date.now();
      if (now > this._lastTime + MAX_STEPS) {
        now = this._lastTime + MAX_STEPS;
      }

      var deltaTime = (now - this._lastTime) / 1000;
      this._frameTime += deltaTime;

      var c = this._damping;
      var m = this._mass;
      var k = this._stiffness;
      var v0 = -this._initialVelocity;

      var zeta = c / (2 * Math.sqrt(k * m));
      var omega0 = Math.sqrt(k / m);
      var omega1 = omega0 * Math.sqrt(1.0 - zeta * zeta);
      var x0 = this._toValue - this._startPosition;

      var position = 0.0;
      var velocity = 0.0;
      var t = this._frameTime;
      if (zeta < 1) {

        var envelope = Math.exp(-zeta * omega0 * t);
        position =
        this._toValue -
        envelope * (
        (v0 + zeta * omega0 * x0) / omega1 * Math.sin(omega1 * t) +
        x0 * Math.cos(omega1 * t));


        velocity =
        zeta *
        omega0 *
        envelope * (
        Math.sin(omega1 * t) * (v0 + zeta * omega0 * x0) / omega1 +
        x0 * Math.cos(omega1 * t)) -
        envelope * (
        Math.cos(omega1 * t) * (v0 + zeta * omega0 * x0) -
        omega1 * x0 * Math.sin(omega1 * t));
      } else {

        var _envelope = Math.exp(-omega0 * t);
        position = this._toValue - _envelope * (x0 + (v0 + omega0 * x0) * t);
        velocity =
        _envelope * (v0 * (t * omega0 - 1) + t * x0 * (omega0 * omega0));
      }

      this._lastTime = now;
      this._lastPosition = position;
      this._lastVelocity = velocity;

      this._onUpdate(position);
      if (!this.__active) {

        return;
      }


      var isOvershooting = false;
      if (this._overshootClamping && this._stiffness !== 0) {
        if (this._startPosition < this._toValue) {
          isOvershooting = position > this._toValue;
        } else {
          isOvershooting = position < this._toValue;
        }
      }
      var isVelocity = Math.abs(velocity) <= this._restSpeedThreshold;
      var isDisplacement = true;
      if (this._stiffness !== 0) {
        isDisplacement =
        Math.abs(this._toValue - position) <= this._restDisplacementThreshold;
      }

      if (isOvershooting || isVelocity && isDisplacement) {
        if (this._stiffness !== 0) {

          this._lastPosition = this._toValue;
          this._lastVelocity = 0;
          this._onUpdate(this._toValue);
        }

        this.__debouncedOnEnd({ finished: true });
        return;
      }
      this._animationFrame = requestAnimationFrame(this.onUpdate.bind(this));
    } }, { key: 'stop', value: function stop()

    {
      _get(SpringAnimation.prototype.__proto__ || Object.getPrototypeOf(SpringAnimation.prototype), 'stop', this).call(this);
      this.__active = false;
      clearTimeout(this._timeout);
      global.cancelAnimationFrame(this._animationFrame);
      this.__debouncedOnEnd({ finished: false });
    } }]);return SpringAnimation;}(Animation);


module.exports = SpringAnimation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNwcmluZ0FuaW1hdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZFZhbHVlIiwicmVxdWlyZSIsIkFuaW1hdGVkVmFsdWVYWSIsIkFuaW1hdGlvbiIsIlNwcmluZ0NvbmZpZyIsImludmFyaWFudCIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIndpdGhEZWZhdWx0IiwidmFsdWUiLCJkZWZhdWx0VmFsdWUiLCJ1bmRlZmluZWQiLCJTcHJpbmdBbmltYXRpb24iLCJjb25maWciLCJfb3ZlcnNob290Q2xhbXBpbmciLCJvdmVyc2hvb3RDbGFtcGluZyIsIl9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkIiwicmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCIsIl9yZXN0U3BlZWRUaHJlc2hvbGQiLCJyZXN0U3BlZWRUaHJlc2hvbGQiLCJfaW5pdGlhbFZlbG9jaXR5IiwidmVsb2NpdHkiLCJfbGFzdFZlbG9jaXR5IiwiX3RvVmFsdWUiLCJ0b1ZhbHVlIiwiX2RlbGF5IiwiZGVsYXkiLCJfdXNlTmF0aXZlRHJpdmVyIiwiX19pc0ludGVyYWN0aW9uIiwiaXNJbnRlcmFjdGlvbiIsIl9faXRlcmF0aW9ucyIsIml0ZXJhdGlvbnMiLCJzdGlmZm5lc3MiLCJkYW1waW5nIiwibWFzcyIsImJvdW5jaW5lc3MiLCJzcGVlZCIsInRlbnNpb24iLCJmcmljdGlvbiIsIl9zdGlmZm5lc3MiLCJfZGFtcGluZyIsIl9tYXNzIiwic3ByaW5nQ29uZmlnIiwiZnJvbUJvdW5jaW5lc3NBbmRTcGVlZCIsImZyb21PcmlnYW1pVGVuc2lvbkFuZEZyaWN0aW9uIiwidHlwZSIsImluaXRpYWxWZWxvY2l0eSIsImZyb21WYWx1ZSIsIm9uVXBkYXRlIiwib25FbmQiLCJwcmV2aW91c0FuaW1hdGlvbiIsImFuaW1hdGVkVmFsdWUiLCJfX2FjdGl2ZSIsIl9zdGFydFBvc2l0aW9uIiwiX2xhc3RQb3NpdGlvbiIsIl9vblVwZGF0ZSIsIl9fb25FbmQiLCJfbGFzdFRpbWUiLCJEYXRlIiwibm93IiwiX2ZyYW1lVGltZSIsImludGVybmFsU3RhdGUiLCJnZXRJbnRlcm5hbFN0YXRlIiwibGFzdFBvc2l0aW9uIiwibGFzdFZlbG9jaXR5IiwibGFzdFRpbWUiLCJzdGFydCIsIl9fc3RhcnROYXRpdmVBbmltYXRpb24iLCJfdGltZW91dCIsInNldFRpbWVvdXQiLCJNQVhfU1RFUFMiLCJkZWx0YVRpbWUiLCJjIiwibSIsImsiLCJ2MCIsInpldGEiLCJNYXRoIiwic3FydCIsIm9tZWdhMCIsIm9tZWdhMSIsIngwIiwicG9zaXRpb24iLCJ0IiwiZW52ZWxvcGUiLCJleHAiLCJzaW4iLCJjb3MiLCJpc092ZXJzaG9vdGluZyIsImlzVmVsb2NpdHkiLCJhYnMiLCJpc0Rpc3BsYWNlbWVudCIsIl9fZGVib3VuY2VkT25FbmQiLCJmaW5pc2hlZCIsIl9hbmltYXRpb25GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJjbGVhclRpbWVvdXQiLCJnbG9iYWwiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQVNBLGE7O0FBRUEsSUFBTUEsZ0JBQWdCQyxRQUFRLHdCQUFSLENBQXRCO0FBQ0EsSUFBTUMsa0JBQWtCRCxRQUFRLDBCQUFSLENBQXhCO0FBQ0EsSUFBTUUsWUFBWUYsUUFBUSxhQUFSLENBQWxCO0FBQ0EsSUFBTUcsZUFBZUgsUUFBUSxpQkFBUixDQUFyQjs7QUFFQSxJQUFNSSxZQUFZSixRQUFRLG9CQUFSLENBQWxCLEM7QUFDZ0NBLFFBQVEseUJBQVIsQyxDQUF6QksscUIsWUFBQUEscUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9DUCxTQUFTQyxXQUFULENBQXdCQyxLQUF4QixFQUFtQ0MsWUFBbkMsRUFBdUQ7QUFDckQsTUFBSUQsVUFBVUUsU0FBVixJQUF1QkYsVUFBVSxJQUFyQyxFQUEyQztBQUN6QyxXQUFPQyxZQUFQO0FBQ0Q7QUFDRCxTQUFPRCxLQUFQO0FBQ0QsQzs7QUFF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QUFxQixLQUFLL0IsUUFBMUI7QUFDQSxlQUFLRCxhQUFMLEdBQXFCLENBQXJCO0FBQ0EsZUFBS2lDLFNBQUwsQ0FBZSxLQUFLaEMsUUFBcEI7QUFDRDs7QUFFRCxhQUFLcUUsZ0JBQUwsQ0FBc0IsRUFBQ0MsVUFBVSxJQUFYLEVBQXRCO0FBQ0E7QUFDRDtBQUNELFdBQUtDLGVBQUwsR0FBdUJDLHNCQUFzQixLQUFLL0MsUUFBTCxDQUFjZ0QsSUFBZCxDQUFtQixJQUFuQixDQUF0QixDQUF2QjtBQUNELEs7O0FBRVk7QUFDWDtBQUNBLFdBQUs1QyxRQUFMLEdBQWdCLEtBQWhCO0FBQ0E2QyxtQkFBYSxLQUFLN0IsUUFBbEI7QUFDQThCLGFBQU9DLG9CQUFQLENBQTRCLEtBQUtMLGVBQWpDO0FBQ0EsV0FBS0YsZ0JBQUwsQ0FBc0IsRUFBQ0MsVUFBVSxLQUFYLEVBQXRCO0FBQ0QsSyw4QkFuUjJCekYsUzs7O0FBc1I5QmdHLE9BQU9DLE9BQVAsR0FBaUJ6RixlQUFqQiIsImZpbGUiOiJTcHJpbmdBbmltYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgQW5pbWF0ZWRWYWx1ZSA9IHJlcXVpcmUoJy4uL25vZGVzL0FuaW1hdGVkVmFsdWUnKTtcbmNvbnN0IEFuaW1hdGVkVmFsdWVYWSA9IHJlcXVpcmUoJy4uL25vZGVzL0FuaW1hdGVkVmFsdWVYWScpO1xuY29uc3QgQW5pbWF0aW9uID0gcmVxdWlyZSgnLi9BbmltYXRpb24nKTtcbmNvbnN0IFNwcmluZ0NvbmZpZyA9IHJlcXVpcmUoJy4uL1NwcmluZ0NvbmZpZycpO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdmYmpzL2xpYi9pbnZhcmlhbnQnKTtcbmNvbnN0IHtzaG91bGRVc2VOYXRpdmVEcml2ZXJ9ID0gcmVxdWlyZSgnLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXInKTtcblxuaW1wb3J0IHR5cGUge0FuaW1hdGlvbkNvbmZpZywgRW5kQ2FsbGJhY2t9IGZyb20gJy4vQW5pbWF0aW9uJztcblxuZXhwb3J0IHR5cGUgU3ByaW5nQW5pbWF0aW9uQ29uZmlnID0gQW5pbWF0aW9uQ29uZmlnICYge1xuICB0b1ZhbHVlOiBudW1iZXIgfCBBbmltYXRlZFZhbHVlIHwge3g6IG51bWJlciwgeTogbnVtYmVyfSB8IEFuaW1hdGVkVmFsdWVYWSxcbiAgb3ZlcnNob290Q2xhbXBpbmc/OiBib29sZWFuLFxuICByZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkPzogbnVtYmVyLFxuICByZXN0U3BlZWRUaHJlc2hvbGQ/OiBudW1iZXIsXG4gIHZlbG9jaXR5PzogbnVtYmVyIHwge3g6IG51bWJlciwgeTogbnVtYmVyfSxcbiAgYm91bmNpbmVzcz86IG51bWJlcixcbiAgc3BlZWQ/OiBudW1iZXIsXG4gIHRlbnNpb24/OiBudW1iZXIsXG4gIGZyaWN0aW9uPzogbnVtYmVyLFxuICBzdGlmZm5lc3M/OiBudW1iZXIsXG4gIGRhbXBpbmc/OiBudW1iZXIsXG4gIG1hc3M/OiBudW1iZXIsXG4gIGRlbGF5PzogbnVtYmVyLFxufTtcblxuZXhwb3J0IHR5cGUgU3ByaW5nQW5pbWF0aW9uQ29uZmlnU2luZ2xlID0gQW5pbWF0aW9uQ29uZmlnICYge1xuICB0b1ZhbHVlOiBudW1iZXIgfCBBbmltYXRlZFZhbHVlLFxuICBvdmVyc2hvb3RDbGFtcGluZz86IGJvb2xlYW4sXG4gIHJlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQ/OiBudW1iZXIsXG4gIHJlc3RTcGVlZFRocmVzaG9sZD86IG51bWJlcixcbiAgdmVsb2NpdHk/OiBudW1iZXIsXG4gIGJvdW5jaW5lc3M/OiBudW1iZXIsXG4gIHNwZWVkPzogbnVtYmVyLFxuICB0ZW5zaW9uPzogbnVtYmVyLFxuICBmcmljdGlvbj86IG51bWJlcixcbiAgc3RpZmZuZXNzPzogbnVtYmVyLFxuICBkYW1waW5nPzogbnVtYmVyLFxuICBtYXNzPzogbnVtYmVyLFxuICBkZWxheT86IG51bWJlcixcbn07XG5cbmZ1bmN0aW9uIHdpdGhEZWZhdWx0PFQ+KHZhbHVlOiA/VCwgZGVmYXVsdFZhbHVlOiBUKTogVCB7XG4gIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5cbmNsYXNzIFNwcmluZ0FuaW1hdGlvbiBleHRlbmRzIEFuaW1hdGlvbiB7XG4gIF9vdmVyc2hvb3RDbGFtcGluZzogYm9vbGVhbjtcbiAgX3Jlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQ6IG51bWJlcjtcbiAgX3Jlc3RTcGVlZFRocmVzaG9sZDogbnVtYmVyO1xuICBfbGFzdFZlbG9jaXR5OiBudW1iZXI7XG4gIF9zdGFydFBvc2l0aW9uOiBudW1iZXI7XG4gIF9sYXN0UG9zaXRpb246IG51bWJlcjtcbiAgX2Zyb21WYWx1ZTogbnVtYmVyO1xuICBfdG9WYWx1ZTogYW55O1xuICBfc3RpZmZuZXNzOiBudW1iZXI7XG4gIF9kYW1waW5nOiBudW1iZXI7XG4gIF9tYXNzOiBudW1iZXI7XG4gIF9pbml0aWFsVmVsb2NpdHk6IG51bWJlcjtcbiAgX2RlbGF5OiBudW1iZXI7XG4gIF90aW1lb3V0OiBhbnk7XG4gIF9zdGFydFRpbWU6IG51bWJlcjtcbiAgX2xhc3RUaW1lOiBudW1iZXI7XG4gIF9mcmFtZVRpbWU6IG51bWJlcjtcbiAgX29uVXBkYXRlOiAodmFsdWU6IG51bWJlcikgPT4gdm9pZDtcbiAgX2FuaW1hdGlvbkZyYW1lOiBhbnk7XG4gIF91c2VOYXRpdmVEcml2ZXI6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBTcHJpbmdBbmltYXRpb25Db25maWdTaW5nbGUpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy5fb3ZlcnNob290Q2xhbXBpbmcgPSB3aXRoRGVmYXVsdChjb25maWcub3ZlcnNob290Q2xhbXBpbmcsIGZhbHNlKTtcbiAgICB0aGlzLl9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkID0gd2l0aERlZmF1bHQoXG4gICAgICBjb25maWcucmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCxcbiAgICAgIDAuMDAxLFxuICAgICk7XG4gICAgdGhpcy5fcmVzdFNwZWVkVGhyZXNob2xkID0gd2l0aERlZmF1bHQoY29uZmlnLnJlc3RTcGVlZFRocmVzaG9sZCwgMC4wMDEpO1xuICAgIHRoaXMuX2luaXRpYWxWZWxvY2l0eSA9IHdpdGhEZWZhdWx0KGNvbmZpZy52ZWxvY2l0eSwgMCk7XG4gICAgdGhpcy5fbGFzdFZlbG9jaXR5ID0gd2l0aERlZmF1bHQoY29uZmlnLnZlbG9jaXR5LCAwKTtcbiAgICB0aGlzLl90b1ZhbHVlID0gY29uZmlnLnRvVmFsdWU7XG4gICAgdGhpcy5fZGVsYXkgPSB3aXRoRGVmYXVsdChjb25maWcuZGVsYXksIDApO1xuICAgIHRoaXMuX3VzZU5hdGl2ZURyaXZlciA9IHNob3VsZFVzZU5hdGl2ZURyaXZlcihjb25maWcpO1xuICAgIHRoaXMuX19pc0ludGVyYWN0aW9uID1cbiAgICAgIGNvbmZpZy5pc0ludGVyYWN0aW9uICE9PSB1bmRlZmluZWQgPyBjb25maWcuaXNJbnRlcmFjdGlvbiA6IHRydWU7XG4gICAgdGhpcy5fX2l0ZXJhdGlvbnMgPSBjb25maWcuaXRlcmF0aW9ucyAhPT0gdW5kZWZpbmVkID8gY29uZmlnLml0ZXJhdGlvbnMgOiAxO1xuXG4gICAgaWYgKFxuICAgICAgY29uZmlnLnN0aWZmbmVzcyAhPT0gdW5kZWZpbmVkIHx8XG4gICAgICBjb25maWcuZGFtcGluZyAhPT0gdW5kZWZpbmVkIHx8XG4gICAgICBjb25maWcubWFzcyAhPT0gdW5kZWZpbmVkXG4gICAgKSB7XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIGNvbmZpZy5ib3VuY2luZXNzID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBjb25maWcuc3BlZWQgPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy50ZW5zaW9uID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBjb25maWcuZnJpY3Rpb24gPT09IHVuZGVmaW5lZCxcbiAgICAgICAgJ1lvdSBjYW4gZGVmaW5lIG9uZSBvZiBib3VuY2luZXNzL3NwZWVkLCB0ZW5zaW9uL2ZyaWN0aW9uLCBvciBzdGlmZm5lc3MvZGFtcGluZy9tYXNzLCBidXQgbm90IG1vcmUgdGhhbiBvbmUnLFxuICAgICAgKTtcbiAgICAgIHRoaXMuX3N0aWZmbmVzcyA9IHdpdGhEZWZhdWx0KGNvbmZpZy5zdGlmZm5lc3MsIDEwMCk7XG4gICAgICB0aGlzLl9kYW1waW5nID0gd2l0aERlZmF1bHQoY29uZmlnLmRhbXBpbmcsIDEwKTtcbiAgICAgIHRoaXMuX21hc3MgPSB3aXRoRGVmYXVsdChjb25maWcubWFzcywgMSk7XG4gICAgfSBlbHNlIGlmIChjb25maWcuYm91bmNpbmVzcyAhPT0gdW5kZWZpbmVkIHx8IGNvbmZpZy5zcGVlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBDb252ZXJ0IHRoZSBvcmlnYW1pIGJvdW5jaW5lc3Mvc3BlZWQgdmFsdWVzIHRvIHN0aWZmbmVzcy9kYW1waW5nXG4gICAgICAvLyBXZSBhc3N1bWUgbWFzcyBpcyAxLlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICBjb25maWcudGVuc2lvbiA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLmZyaWN0aW9uID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBjb25maWcuc3RpZmZuZXNzID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBjb25maWcuZGFtcGluZyA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLm1hc3MgPT09IHVuZGVmaW5lZCxcbiAgICAgICAgJ1lvdSBjYW4gZGVmaW5lIG9uZSBvZiBib3VuY2luZXNzL3NwZWVkLCB0ZW5zaW9uL2ZyaWN0aW9uLCBvciBzdGlmZm5lc3MvZGFtcGluZy9tYXNzLCBidXQgbm90IG1vcmUgdGhhbiBvbmUnLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHNwcmluZ0NvbmZpZyA9IFNwcmluZ0NvbmZpZy5mcm9tQm91bmNpbmVzc0FuZFNwZWVkKFxuICAgICAgICB3aXRoRGVmYXVsdChjb25maWcuYm91bmNpbmVzcywgOCksXG4gICAgICAgIHdpdGhEZWZhdWx0KGNvbmZpZy5zcGVlZCwgMTIpLFxuICAgICAgKTtcbiAgICAgIHRoaXMuX3N0aWZmbmVzcyA9IHNwcmluZ0NvbmZpZy5zdGlmZm5lc3M7XG4gICAgICB0aGlzLl9kYW1waW5nID0gc3ByaW5nQ29uZmlnLmRhbXBpbmc7XG4gICAgICB0aGlzLl9tYXNzID0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ29udmVydCB0aGUgb3JpZ2FtaSB0ZW5zaW9uL2ZyaWN0aW9uIHZhbHVlcyB0byBzdGlmZm5lc3MvZGFtcGluZ1xuICAgICAgLy8gV2UgYXNzdW1lIG1hc3MgaXMgMS5cbiAgICAgIGNvbnN0IHNwcmluZ0NvbmZpZyA9IFNwcmluZ0NvbmZpZy5mcm9tT3JpZ2FtaVRlbnNpb25BbmRGcmljdGlvbihcbiAgICAgICAgd2l0aERlZmF1bHQoY29uZmlnLnRlbnNpb24sIDQwKSxcbiAgICAgICAgd2l0aERlZmF1bHQoY29uZmlnLmZyaWN0aW9uLCA3KSxcbiAgICAgICk7XG4gICAgICB0aGlzLl9zdGlmZm5lc3MgPSBzcHJpbmdDb25maWcuc3RpZmZuZXNzO1xuICAgICAgdGhpcy5fZGFtcGluZyA9IHNwcmluZ0NvbmZpZy5kYW1waW5nO1xuICAgICAgdGhpcy5fbWFzcyA9IDE7XG4gICAgfVxuXG4gICAgaW52YXJpYW50KHRoaXMuX3N0aWZmbmVzcyA+IDAsICdTdGlmZm5lc3MgdmFsdWUgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCcpO1xuICAgIGludmFyaWFudCh0aGlzLl9kYW1waW5nID4gMCwgJ0RhbXBpbmcgdmFsdWUgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCcpO1xuICAgIGludmFyaWFudCh0aGlzLl9tYXNzID4gMCwgJ01hc3MgdmFsdWUgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCcpO1xuICB9XG5cbiAgX19nZXROYXRpdmVBbmltYXRpb25Db25maWcoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdzcHJpbmcnLFxuICAgICAgb3ZlcnNob290Q2xhbXBpbmc6IHRoaXMuX292ZXJzaG9vdENsYW1waW5nLFxuICAgICAgcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZDogdGhpcy5fcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCxcbiAgICAgIHJlc3RTcGVlZFRocmVzaG9sZDogdGhpcy5fcmVzdFNwZWVkVGhyZXNob2xkLFxuICAgICAgc3RpZmZuZXNzOiB0aGlzLl9zdGlmZm5lc3MsXG4gICAgICBkYW1waW5nOiB0aGlzLl9kYW1waW5nLFxuICAgICAgbWFzczogdGhpcy5fbWFzcyxcbiAgICAgIGluaXRpYWxWZWxvY2l0eTogd2l0aERlZmF1bHQodGhpcy5faW5pdGlhbFZlbG9jaXR5LCB0aGlzLl9sYXN0VmVsb2NpdHkpLFxuICAgICAgdG9WYWx1ZTogdGhpcy5fdG9WYWx1ZSxcbiAgICAgIGl0ZXJhdGlvbnM6IHRoaXMuX19pdGVyYXRpb25zLFxuICAgIH07XG4gIH1cblxuICBzdGFydChcbiAgICBmcm9tVmFsdWU6IG51bWJlcixcbiAgICBvblVwZGF0ZTogKHZhbHVlOiBudW1iZXIpID0+IHZvaWQsXG4gICAgb25FbmQ6ID9FbmRDYWxsYmFjayxcbiAgICBwcmV2aW91c0FuaW1hdGlvbjogP0FuaW1hdGlvbixcbiAgICBhbmltYXRlZFZhbHVlOiBBbmltYXRlZFZhbHVlLFxuICApOiB2b2lkIHtcbiAgICB0aGlzLl9fYWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLl9zdGFydFBvc2l0aW9uID0gZnJvbVZhbHVlO1xuICAgIHRoaXMuX2xhc3RQb3NpdGlvbiA9IHRoaXMuX3N0YXJ0UG9zaXRpb247XG5cbiAgICB0aGlzLl9vblVwZGF0ZSA9IG9uVXBkYXRlO1xuICAgIHRoaXMuX19vbkVuZCA9IG9uRW5kO1xuICAgIHRoaXMuX2xhc3RUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB0aGlzLl9mcmFtZVRpbWUgPSAwLjA7XG5cbiAgICBpZiAocHJldmlvdXNBbmltYXRpb24gaW5zdGFuY2VvZiBTcHJpbmdBbmltYXRpb24pIHtcbiAgICAgIGNvbnN0IGludGVybmFsU3RhdGUgPSBwcmV2aW91c0FuaW1hdGlvbi5nZXRJbnRlcm5hbFN0YXRlKCk7XG4gICAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSBpbnRlcm5hbFN0YXRlLmxhc3RQb3NpdGlvbjtcbiAgICAgIHRoaXMuX2xhc3RWZWxvY2l0eSA9IGludGVybmFsU3RhdGUubGFzdFZlbG9jaXR5O1xuICAgICAgLy8gU2V0IHRoZSBpbml0aWFsIHZlbG9jaXR5IHRvIHRoZSBsYXN0IHZlbG9jaXR5XG4gICAgICB0aGlzLl9pbml0aWFsVmVsb2NpdHkgPSB0aGlzLl9sYXN0VmVsb2NpdHk7XG4gICAgICB0aGlzLl9sYXN0VGltZSA9IGludGVybmFsU3RhdGUubGFzdFRpbWU7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhcnQgPSAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5fdXNlTmF0aXZlRHJpdmVyKSB7XG4gICAgICAgIHRoaXMuX19zdGFydE5hdGl2ZUFuaW1hdGlvbihhbmltYXRlZFZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub25VcGRhdGUoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gIElmIHRoaXMuX2RlbGF5IGlzIG1vcmUgdGhhbiAwLCB3ZSBzdGFydCBhZnRlciB0aGUgdGltZW91dC5cbiAgICBpZiAodGhpcy5fZGVsYXkpIHtcbiAgICAgIHRoaXMuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KHN0YXJ0LCB0aGlzLl9kZWxheSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXJ0KCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0SW50ZXJuYWxTdGF0ZSgpOiBPYmplY3Qge1xuICAgIHJldHVybiB7XG4gICAgICBsYXN0UG9zaXRpb246IHRoaXMuX2xhc3RQb3NpdGlvbixcbiAgICAgIGxhc3RWZWxvY2l0eTogdGhpcy5fbGFzdFZlbG9jaXR5LFxuICAgICAgbGFzdFRpbWU6IHRoaXMuX2xhc3RUaW1lLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBzcHJpbmcgbW9kZWwgaXMgYmFzZWQgb2ZmIG9mIGEgZGFtcGVkIGhhcm1vbmljIG9zY2lsbGF0b3JcbiAgICogKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0hhcm1vbmljX29zY2lsbGF0b3IjRGFtcGVkX2hhcm1vbmljX29zY2lsbGF0b3IpLlxuICAgKlxuICAgKiBXZSB1c2UgdGhlIGNsb3NlZCBmb3JtIG9mIHRoZSBzZWNvbmQgb3JkZXIgZGlmZmVyZW50aWFsIGVxdWF0aW9uOlxuICAgKlxuICAgKiB4JycgKyAoMs624o21XzApeCcgKyDijbVeMnggPSAwXG4gICAqXG4gICAqIHdoZXJlXG4gICAqICAgIOKNtV8wID0g4oiaKGsgLyBtKSAodW5kYW1wZWQgYW5ndWxhciBmcmVxdWVuY3kgb2YgdGhlIG9zY2lsbGF0b3IpLFxuICAgKiAgICDOtiA9IGMgLyAy4oiabWsgKGRhbXBpbmcgcmF0aW8pLFxuICAgKiAgICBjID0gZGFtcGluZyBjb25zdGFudFxuICAgKiAgICBrID0gc3RpZmZuZXNzXG4gICAqICAgIG0gPSBtYXNzXG4gICAqXG4gICAqIFRoZSBkZXJpdmF0aW9uIG9mIHRoZSBjbG9zZWQgZm9ybSBpcyBkZXNjcmliZWQgaW4gZGV0YWlsIGhlcmU6XG4gICAqIGh0dHA6Ly9wbGFuZXRtYXRoLm9yZy9zaXRlcy9kZWZhdWx0L2ZpbGVzL3RleHBkZi8zOTc0NS5wZGZcbiAgICpcbiAgICogVGhpcyBhbGdvcml0aG0gaGFwcGVucyB0byBtYXRjaCB0aGUgYWxnb3JpdGhtIHVzZWQgYnkgQ0FTcHJpbmdBbmltYXRpb24sXG4gICAqIGEgUXVhcnR6Q29yZSAoaU9TKSBBUEkgdGhhdCBjcmVhdGVzIHNwcmluZyBhbmltYXRpb25zLlxuICAgKi9cbiAgb25VcGRhdGUoKTogdm9pZCB7XG4gICAgLy8gSWYgZm9yIHNvbWUgcmVhc29uIHdlIGxvc3QgYSBsb3Qgb2YgZnJhbWVzIChlLmcuIHByb2Nlc3MgbGFyZ2UgcGF5bG9hZCBvclxuICAgIC8vIHN0b3BwZWQgaW4gdGhlIGRlYnVnZ2VyKSwgd2Ugb25seSBhZHZhbmNlIGJ5IDQgZnJhbWVzIHdvcnRoIG9mXG4gICAgLy8gY29tcHV0YXRpb24gYW5kIHdpbGwgY29udGludWUgb24gdGhlIG5leHQgZnJhbWUuIEl0J3MgYmV0dGVyIHRvIGhhdmUgaXRcbiAgICAvLyBydW5uaW5nIGF0IGZhc3RlciBzcGVlZCB0aGFuIGp1bXBpbmcgdG8gdGhlIGVuZC5cbiAgICBjb25zdCBNQVhfU1RFUFMgPSA2NDtcbiAgICBsZXQgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBpZiAobm93ID4gdGhpcy5fbGFzdFRpbWUgKyBNQVhfU1RFUFMpIHtcbiAgICAgIG5vdyA9IHRoaXMuX2xhc3RUaW1lICsgTUFYX1NURVBTO1xuICAgIH1cblxuICAgIGNvbnN0IGRlbHRhVGltZSA9IChub3cgLSB0aGlzLl9sYXN0VGltZSkgLyAxMDAwO1xuICAgIHRoaXMuX2ZyYW1lVGltZSArPSBkZWx0YVRpbWU7XG5cbiAgICBjb25zdCBjOiBudW1iZXIgPSB0aGlzLl9kYW1waW5nO1xuICAgIGNvbnN0IG06IG51bWJlciA9IHRoaXMuX21hc3M7XG4gICAgY29uc3QgazogbnVtYmVyID0gdGhpcy5fc3RpZmZuZXNzO1xuICAgIGNvbnN0IHYwOiBudW1iZXIgPSAtdGhpcy5faW5pdGlhbFZlbG9jaXR5O1xuXG4gICAgY29uc3QgemV0YSA9IGMgLyAoMiAqIE1hdGguc3FydChrICogbSkpOyAvLyBkYW1waW5nIHJhdGlvXG4gICAgY29uc3Qgb21lZ2EwID0gTWF0aC5zcXJ0KGsgLyBtKTsgLy8gdW5kYW1wZWQgYW5ndWxhciBmcmVxdWVuY3kgb2YgdGhlIG9zY2lsbGF0b3IgKHJhZC9tcylcbiAgICBjb25zdCBvbWVnYTEgPSBvbWVnYTAgKiBNYXRoLnNxcnQoMS4wIC0gemV0YSAqIHpldGEpOyAvLyBleHBvbmVudGlhbCBkZWNheVxuICAgIGNvbnN0IHgwID0gdGhpcy5fdG9WYWx1ZSAtIHRoaXMuX3N0YXJ0UG9zaXRpb247IC8vIGNhbGN1bGF0ZSB0aGUgb3NjaWxsYXRpb24gZnJvbSB4MCA9IDEgdG8geCA9IDBcblxuICAgIGxldCBwb3NpdGlvbiA9IDAuMDtcbiAgICBsZXQgdmVsb2NpdHkgPSAwLjA7XG4gICAgY29uc3QgdCA9IHRoaXMuX2ZyYW1lVGltZTtcbiAgICBpZiAoemV0YSA8IDEpIHtcbiAgICAgIC8vIFVuZGVyIGRhbXBlZFxuICAgICAgY29uc3QgZW52ZWxvcGUgPSBNYXRoLmV4cCgtemV0YSAqIG9tZWdhMCAqIHQpO1xuICAgICAgcG9zaXRpb24gPVxuICAgICAgICB0aGlzLl90b1ZhbHVlIC1cbiAgICAgICAgZW52ZWxvcGUgKlxuICAgICAgICAgICgoKHYwICsgemV0YSAqIG9tZWdhMCAqIHgwKSAvIG9tZWdhMSkgKiBNYXRoLnNpbihvbWVnYTEgKiB0KSArXG4gICAgICAgICAgICB4MCAqIE1hdGguY29zKG9tZWdhMSAqIHQpKTtcbiAgICAgIC8vIFRoaXMgbG9va3MgY3JhenkgLS0gaXQncyBhY3R1YWxseSBqdXN0IHRoZSBkZXJpdmF0aXZlIG9mIHRoZVxuICAgICAgLy8gb3NjaWxsYXRpb24gZnVuY3Rpb25cbiAgICAgIHZlbG9jaXR5ID1cbiAgICAgICAgemV0YSAqXG4gICAgICAgICAgb21lZ2EwICpcbiAgICAgICAgICBlbnZlbG9wZSAqXG4gICAgICAgICAgKChNYXRoLnNpbihvbWVnYTEgKiB0KSAqICh2MCArIHpldGEgKiBvbWVnYTAgKiB4MCkpIC8gb21lZ2ExICtcbiAgICAgICAgICAgIHgwICogTWF0aC5jb3Mob21lZ2ExICogdCkpIC1cbiAgICAgICAgZW52ZWxvcGUgKlxuICAgICAgICAgIChNYXRoLmNvcyhvbWVnYTEgKiB0KSAqICh2MCArIHpldGEgKiBvbWVnYTAgKiB4MCkgLVxuICAgICAgICAgICAgb21lZ2ExICogeDAgKiBNYXRoLnNpbihvbWVnYTEgKiB0KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENyaXRpY2FsbHkgZGFtcGVkXG4gICAgICBjb25zdCBlbnZlbG9wZSA9IE1hdGguZXhwKC1vbWVnYTAgKiB0KTtcbiAgICAgIHBvc2l0aW9uID0gdGhpcy5fdG9WYWx1ZSAtIGVudmVsb3BlICogKHgwICsgKHYwICsgb21lZ2EwICogeDApICogdCk7XG4gICAgICB2ZWxvY2l0eSA9XG4gICAgICAgIGVudmVsb3BlICogKHYwICogKHQgKiBvbWVnYTAgLSAxKSArIHQgKiB4MCAqIChvbWVnYTAgKiBvbWVnYTApKTtcbiAgICB9XG5cbiAgICB0aGlzLl9sYXN0VGltZSA9IG5vdztcbiAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICB0aGlzLl9sYXN0VmVsb2NpdHkgPSB2ZWxvY2l0eTtcblxuICAgIHRoaXMuX29uVXBkYXRlKHBvc2l0aW9uKTtcbiAgICBpZiAoIXRoaXMuX19hY3RpdmUpIHtcbiAgICAgIC8vIGEgbGlzdGVuZXIgbWlnaHQgaGF2ZSBzdG9wcGVkIHVzIGluIF9vblVwZGF0ZVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENvbmRpdGlvbnMgZm9yIHN0b3BwaW5nIHRoZSBzcHJpbmcgYW5pbWF0aW9uXG4gICAgbGV0IGlzT3ZlcnNob290aW5nID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuX292ZXJzaG9vdENsYW1waW5nICYmIHRoaXMuX3N0aWZmbmVzcyAhPT0gMCkge1xuICAgICAgaWYgKHRoaXMuX3N0YXJ0UG9zaXRpb24gPCB0aGlzLl90b1ZhbHVlKSB7XG4gICAgICAgIGlzT3ZlcnNob290aW5nID0gcG9zaXRpb24gPiB0aGlzLl90b1ZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXNPdmVyc2hvb3RpbmcgPSBwb3NpdGlvbiA8IHRoaXMuX3RvVmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGlzVmVsb2NpdHkgPSBNYXRoLmFicyh2ZWxvY2l0eSkgPD0gdGhpcy5fcmVzdFNwZWVkVGhyZXNob2xkO1xuICAgIGxldCBpc0Rpc3BsYWNlbWVudCA9IHRydWU7XG4gICAgaWYgKHRoaXMuX3N0aWZmbmVzcyAhPT0gMCkge1xuICAgICAgaXNEaXNwbGFjZW1lbnQgPVxuICAgICAgICBNYXRoLmFicyh0aGlzLl90b1ZhbHVlIC0gcG9zaXRpb24pIDw9IHRoaXMuX3Jlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQ7XG4gICAgfVxuXG4gICAgaWYgKGlzT3ZlcnNob290aW5nIHx8IChpc1ZlbG9jaXR5ICYmIGlzRGlzcGxhY2VtZW50KSkge1xuICAgICAgaWYgKHRoaXMuX3N0aWZmbmVzcyAhPT0gMCkge1xuICAgICAgICAvLyBFbnN1cmUgdGhhdCB3ZSBlbmQgdXAgd2l0aCBhIHJvdW5kIHZhbHVlXG4gICAgICAgIHRoaXMuX2xhc3RQb3NpdGlvbiA9IHRoaXMuX3RvVmFsdWU7XG4gICAgICAgIHRoaXMuX2xhc3RWZWxvY2l0eSA9IDA7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlKHRoaXMuX3RvVmFsdWUpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9fZGVib3VuY2VkT25FbmQoe2ZpbmlzaGVkOiB0cnVlfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSk7XG4gIH1cblxuICBzdG9wKCk6IHZvaWQge1xuICAgIHN1cGVyLnN0b3AoKTtcbiAgICB0aGlzLl9fYWN0aXZlID0gZmFsc2U7XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVvdXQpO1xuICAgIGdsb2JhbC5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9hbmltYXRpb25GcmFtZSk7XG4gICAgdGhpcy5fX2RlYm91bmNlZE9uRW5kKHtmaW5pc2hlZDogZmFsc2V9KTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFNwcmluZ0FuaW1hdGlvbjtcbiJdfQ==