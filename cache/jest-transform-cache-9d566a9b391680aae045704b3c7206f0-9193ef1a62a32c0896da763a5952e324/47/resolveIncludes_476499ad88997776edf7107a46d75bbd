21b7cb47d6908787013327beedb8f5bd
Object.defineProperty(exports, "__esModule", { value: true });exports.INCLUDE = undefined;var _extends = Object.assign || function (target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i];for (var key in source) {if (Object.prototype.hasOwnProperty.call(source, key)) {target[key] = source[key];}}}return target;};exports.default =



















































resolveIncludes;var _lodash = require('lodash');var _ = _interopRequireWildcard(_lodash);function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _toConsumableArray(arr) {if (Array.isArray(arr)) {for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {arr2[i] = arr[i];}return arr2;} else {return Array.from(arr);}}var INCLUDE = exports.INCLUDE = '@@shoutem.theme/include';function includeSymbolMergeHandler(objVal, srcVal) {var newObjVal = objVal;var include = void 0;if (srcVal && srcVal[INCLUDE]) {include = newObjVal && newObjVal[INCLUDE] ? [].concat(_toConsumableArray(newObjVal[INCLUDE]), _toConsumableArray(srcVal[INCLUDE])) : srcVal[INCLUDE];}if (_.isUndefined(newObjVal) && _.isPlainObject(srcVal)) {var newObj = _.mergeWith({}, srcVal, function (o, s) {return s;});if (include) {newObj[INCLUDE] = include;}return newObj;}if (_.isPlainObject(newObjVal) && include) {newObjVal[INCLUDE] = include;}}function resolveIncludes(target) {var base = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};














  function getStyle(styleName) {
    var defaultStyle = {};
    var style = defaultStyle;

    var baseStyle = base[styleName];
    if (baseStyle) {
      if (baseStyle[INCLUDE]) {
        throw Error('Base style cannot have includes, unexpected include in ' + styleName + '.');
      }
      style = _extends({}, baseStyle);
    }

    var targetStyle = target[styleName];
    if (targetStyle) {
      style = _extends({},
      style,
      targetStyle);

    }

    if (style === defaultStyle) {
      console.warn('Including unexisting style: ' + styleName);
    }

    return style;
  }






  function includeNodeStyles(styleNode, processingStyleNames) {
    if (!_.isPlainObject(styleNode)) {
      return styleNode;
    }


    var styleNamesToInclude = styleNode[INCLUDE];

    var stylesToInclude = {};
    if (styleNamesToInclude) {
      if (!_.isArray(styleNamesToInclude)) {
        throw Error('Include should be array');
      }

      for (var _iterator = styleNamesToInclude, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[typeof Symbol === 'function' ? Symbol.iterator : '@@iterator']();;) {var _ref;if (_isArray) {if (_i >= _iterator.length) break;_ref = _iterator[_i++];} else {_i = _iterator.next();if (_i.done) break;_ref = _i.value;}var styleName = _ref;
        if (processingStyleNames.has(styleName)) {
          throw Error('Circular style include, including ' + styleName);
        }
        processingStyleNames.add(styleName);
        stylesToInclude = _.mergeWith(
        {},
        stylesToInclude,
        includeNodeStyles(getStyle(styleName), processingStyleNames),
        includeSymbolMergeHandler);

        processingStyleNames.delete(styleName);
      }
    }

    var resultingStyle = _.mergeWith({}, stylesToInclude, styleNode, includeSymbolMergeHandler);
    delete resultingStyle[INCLUDE];

    for (var _iterator2 = _.keys(resultingStyle), _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[typeof Symbol === 'function' ? Symbol.iterator : '@@iterator']();;) {var _ref2;if (_isArray2) {if (_i2 >= _iterator2.length) break;_ref2 = _iterator2[_i2++];} else {_i2 = _iterator2.next();if (_i2.done) break;_ref2 = _i2.value;}var _styleName = _ref2;
      resultingStyle[_styleName] =
      includeNodeStyles(resultingStyle[_styleName], processingStyleNames);
    }
    return resultingStyle;
  }




  var processingStyleNames = new Set();
  return includeNodeStyles(target, processingStyleNames);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc29sdmVJbmNsdWRlcy5qcyJdLCJuYW1lcyI6WyJyZXNvbHZlSW5jbHVkZXMiLCJfIiwiSU5DTFVERSIsImluY2x1ZGVTeW1ib2xNZXJnZUhhbmRsZXIiLCJvYmpWYWwiLCJzcmNWYWwiLCJuZXdPYmpWYWwiLCJpbmNsdWRlIiwiaXNVbmRlZmluZWQiLCJpc1BsYWluT2JqZWN0IiwibmV3T2JqIiwibWVyZ2VXaXRoIiwibyIsInMiLCJ0YXJnZXQiLCJiYXNlIiwiZ2V0U3R5bGUiLCJzdHlsZU5hbWUiLCJkZWZhdWx0U3R5bGUiLCJzdHlsZSIsImJhc2VTdHlsZSIsIkVycm9yIiwidGFyZ2V0U3R5bGUiLCJjb25zb2xlIiwid2FybiIsImluY2x1ZGVOb2RlU3R5bGVzIiwic3R5bGVOb2RlIiwicHJvY2Vzc2luZ1N0eWxlTmFtZXMiLCJzdHlsZU5hbWVzVG9JbmNsdWRlIiwic3R5bGVzVG9JbmNsdWRlIiwiaXNBcnJheSIsImhhcyIsImFkZCIsImRlbGV0ZSIsInJlc3VsdGluZ1N0eWxlIiwia2V5cyIsIlNldCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9Ed0JBLGUsQ0FwRHhCLGdDLElBQVlDLEMsOGRBQ0wsSUFBTUMsNEJBQVUseUJBQWhCLENBUVAsU0FBU0MseUJBQVQsQ0FBbUNDLE1BQW5DLEVBQTJDQyxNQUEzQyxFQUFtRCxDQUNqRCxJQUFNQyxZQUFZRixNQUFsQixDQUNBLElBQUlHLGdCQUFKLENBRUEsSUFBSUYsVUFBVUEsT0FBT0gsT0FBUCxDQUFkLEVBQStCLENBQzdCSyxVQUFVRCxhQUFhQSxVQUFVSixPQUFWLENBQWIsZ0NBQ0pJLFVBQVVKLE9BQVYsQ0FESSxzQkFDbUJHLE9BQU9ILE9BQVAsQ0FEbkIsS0FDc0NHLE9BQU9ILE9BQVAsQ0FEaEQsQ0FFRCxDQUdELElBQUlELEVBQUVPLFdBQUYsQ0FBY0YsU0FBZCxLQUE0QkwsRUFBRVEsYUFBRixDQUFnQkos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ZUluY2x1ZGVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuZXhwb3J0IGNvbnN0IElOQ0xVREUgPSAnQEBzaG91dGVtLnRoZW1lL2luY2x1ZGUnO1xuXG4vKipcbiAqIEN1c3RvbWl6ZXIgZnVuY3Rpb24gZm9yIGxvZGFzaCBtZXJnZVdpdGggd2hpY2ggaGFuZGxlIElOQ0xVREUgc3ltYm9sLlxuICogTG9kYXNoIG1lcmdlL21lcmdlV2l0aCBmdW5jdGlvbnMgZG9lc24ndCBtZXJnZSBzeW1ib2xzXG4gKiBhbmQgd2UgdXNlIElOQ0xVREUgc3ltYm9sIHRvIGRlZmluZSB3aGljaCBzdHlsZSB3ZSB3YW50IHRvIGluY2x1ZGUuXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb25zaXN0ZW50LXJldHVyblxuZnVuY3Rpb24gaW5jbHVkZVN5bWJvbE1lcmdlSGFuZGxlcihvYmpWYWwsIHNyY1ZhbCkge1xuICBjb25zdCBuZXdPYmpWYWwgPSBvYmpWYWw7XG4gIGxldCBpbmNsdWRlO1xuXG4gIGlmIChzcmNWYWwgJiYgc3JjVmFsW0lOQ0xVREVdKSB7XG4gICAgaW5jbHVkZSA9IG5ld09ialZhbCAmJiBuZXdPYmpWYWxbSU5DTFVERV0gP1xuICAgICAgWy4uLm5ld09ialZhbFtJTkNMVURFXSwgLi4uc3JjVmFsW0lOQ0xVREVdXSA6IHNyY1ZhbFtJTkNMVURFXTtcbiAgfVxuXG4gIC8vIGlmIG9ialZhbCBkb2Vzbid0IGV4aXN0cyBjcmVhdGUgbmV3IGZyb20gc291cmNlXG4gIGlmIChfLmlzVW5kZWZpbmVkKG5ld09ialZhbCkgJiYgXy5pc1BsYWluT2JqZWN0KHNyY1ZhbCkpIHtcbiAgICAvLyBDb3B5IHN5bWJvbCBmaXguXG4gICAgLy8geyAuLi5zcmNWYWwgfSBjb3BpZXMgc3ltYm9sIHdyb25nLCBpdCBhZGRzIHN5bWJvbCB2YWx1ZSB0byB0aGUgcHJvcGVydHkgZGVmaW5lZCBqdXN0IGFmdGVyIGl0XG4gICAgLy8gUHJvYmxlbSBleGFtcGxlOiB7IFNZTUJPTDogWydUZXN0J10sIHNvbWVQcm9wOiAxMCB9ID0+IHsgc29tZVByb3A6IFsnVGVzdCddIH1cbiAgICAvLyBtZXJnZVdpdGggcHJldmVudHMgd3JvbmcgY29weSBiZWNhdXNlIGl0IGRvZXNuJ3QgaXRlcmF0ZSB0cm91Z2ggU3ltYm9scyBzbyBpdCBza2lwcyBJTkNMVURFXG4gICAgLy8gV2UgZG8gbm90IElOQ0xVREUgc3ltYm9sIHRvIGJlIGNvcGllZCBhY3R1YWxseSBpbiB0aGlzIGZ1bmN0aW9uXG4gICAgLy8gYmVjYXVzZSBpdCBpcyBjb3BpZWQgbWFudWFsbHkuIFRoaXMgd2hvbGUgZnVuY3Rpb24gaXMgZml4aW5nIFN5bWJvbCBwcm9ibGVtcy5cbiAgICBjb25zdCBuZXdPYmogPSBfLm1lcmdlV2l0aCh7fSwgc3JjVmFsLCAobywgcykgPT4gcyk7XG4gICAgLy8gQXNzaWduaW5nIElOQ0xVREUgYWZ0ZXIgb2JqZWN0IGRlZmluaXRpb24gdG8gYXZvaWQgT2JqZWN0LmFzc2lnbiB3aGVuIGNvZGUgdHJhbnNwaWxlZC5cbiAgICAvLyBPYmplY3QuYXNzaWduIGluIFJOIHVzZXMgcG9seWZpbGwgd2hpY2ggZG9lc24ndCBjb3B5IFN5bWJvbHMgdGhhdCdzIHdoeSBJTkNMVURFIHN5bWJvbFxuICAgIC8vIG11c3QgYmUgc2V0IG1hbnVhbGx5IGFmdGVyIHNwcmVhZC5cbiAgICAvLyBUT0RPKEJyYWNvKSAtIG9uY2UgT2JqZWN0LmFzc2lnbiBwb2x5ZmlsbCBpcyBubyBsb25nZXIgdXNlZCB1c2UgY29tbWVudGVkIGNvZGUgYmVsbG93XG4gICAgLy8gQ2hlY2sgaWYgYGN1c3RvbWl6ZXJgIGlzIG5lZWRlZCBzdGlsbCBhdCBhbGwgYWZ0ZXIgcG9seWZpbGwgaXMgcmVtb3ZlZCFcbiAgICAvLyByZXR1cm4geyAuLi5zcmNWYWwsIFtJTkNMVURFXTogaW5jbHVkZSB9OyAvLyBhZGQgbmV3IGxpbmVzIGZvciBlYWNoIHByb3BlcnR5XG4gICAgaWYgKGluY2x1ZGUpIHtcbiAgICAgIG5ld09ialtJTkNMVURFXSA9IGluY2x1ZGU7XG4gICAgfVxuICAgIHJldHVybiBuZXdPYmo7XG4gIH1cblxuICAvLyBvdGhlcndpc2UgbGV0IGxvZGFzaCBkZWZhdWx0IG1lcmdlIChyZXR1cm4gdW5kZWZpbmVkKVxuICAvLyBhbmQgYWRkIElOQ0xVREUgdG8gb2JqVmFsIGlmIGFueSBpbiBzcmNWYWxcbiAgaWYgKF8uaXNQbGFpbk9iamVjdChuZXdPYmpWYWwpICYmIGluY2x1ZGUpIHtcbiAgICBuZXdPYmpWYWxbSU5DTFVERV0gPSBpbmNsdWRlO1xuICB9XG59XG5cbi8qKlxuICogUmVjdXJzaXZlbHkgaW5jbHVkZSByZXF1aXJlZCB0YXJnZXQgc3R5bGVzIGZyb20gdGFyZ2V0IGFuZCBiYXNlIHJvb3QuXG4gKlxuICogQHBhcmFtIHRhcmdldCAtIHN0eWxlcyBvYmplY3QgY29udGFpbmluZ1xuICogQHBhcmFtIGJhc2UgLSBhZGRpdGlvbmFsIHN0eWxlIG9iamVjdCBmcm9tIHdoaWNoIHRhcmdldCBtYXkgaW5jbHVkZSBzdHlsZVxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiByZXNvbHZlSW5jbHVkZXModGFyZ2V0LCBiYXNlID0ge30pIHtcbiAgLyoqXG4gICAqIEluY2x1ZGUgcHJvY2VzcyBzdGVwczpcbiAgICogMS4gSXRlcmF0ZSB0aHJvdWdoIHRhcmdldCBvYmplY3QsIGNoZWNrIGlmIHByb3BlcnR5IGlzIG9iamVjdCBhbmQgaWYgaXQgaGFzIFtJTkNMVURFXVxuICAgKiAyLmEuIElmIHByb3BlcnR5IGlzIG9iamVjdCwgcmVwZWF0IHByb2Nlc3MgZm9yIHRoYXQgb2JqZWN0XG4gICAqIDIuYi4gSWYgcHJvcGVydHkgaXMgbm90IG9iamVjdCBsZWF2ZSB2YWx1ZSBhcyBpc1xuICAgKiAzLiBJbmNsdWRlIGFueSBbSU5DTFVERV0gKHJlcXVpcmVkIHN0eWxlKVxuICAgKiAgMS4gUmVwZWF0IHByb2Nlc3MgZm9yIHJlcXVpcmVkIHN0eWxlIChjaGVjayBpZiBpdCBoYXMgYW55IFtJTkNMVURFXSlcbiAgICovXG5cbiAgLyoqXG4gICAqIE1lcmdlcyBzdHlsZSBmcm9tIHRhcmdldCBhbmQgYmFzZS5cbiAgICogVGFyZ2V0IHN0eWxlIG92ZXJyaWRlcyBiYXNlLlxuICAgKiBAcGFyYW0gc3R5bGVOYW1lIC0gc3R5bGUgbmFtZSB0byBpbmNsdWRlXG4gICAqL1xuICBmdW5jdGlvbiBnZXRTdHlsZShzdHlsZU5hbWUpIHtcbiAgICBjb25zdCBkZWZhdWx0U3R5bGUgPSB7fTtcbiAgICBsZXQgc3R5bGUgPSBkZWZhdWx0U3R5bGU7XG5cbiAgICBjb25zdCBiYXNlU3R5bGUgPSBiYXNlW3N0eWxlTmFtZV07XG4gICAgaWYgKGJhc2VTdHlsZSkge1xuICAgICAgaWYgKGJhc2VTdHlsZVtJTkNMVURFXSkge1xuICAgICAgICB0aHJvdyBFcnJvcihgQmFzZSBzdHlsZSBjYW5ub3QgaGF2ZSBpbmNsdWRlcywgdW5leHBlY3RlZCBpbmNsdWRlIGluICR7c3R5bGVOYW1lfS5gKTtcbiAgICAgIH1cbiAgICAgIHN0eWxlID0geyAuLi5iYXNlU3R5bGUgfTtcbiAgICB9XG5cbiAgICBjb25zdCB0YXJnZXRTdHlsZSA9IHRhcmdldFtzdHlsZU5hbWVdO1xuICAgIGlmICh0YXJnZXRTdHlsZSkge1xuICAgICAgc3R5bGUgPSB7XG4gICAgICAgIC4uLnN0eWxlLFxuICAgICAgICAuLi50YXJnZXRTdHlsZSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHN0eWxlID09PSBkZWZhdWx0U3R5bGUpIHtcbiAgICAgIGNvbnNvbGUud2FybihgSW5jbHVkaW5nIHVuZXhpc3Rpbmcgc3R5bGU6ICR7c3R5bGVOYW1lfWApO1xuICAgIH1cblxuICAgIHJldHVybiBzdHlsZTtcbiAgfVxuXG4gIC8vIEluY2x1ZGVzIGFsbCBzdHlsZXMgcmVxdWlyZWQgYnkgdXNpbmcgdGhlIElOQ0xVREUgc3ltYm9sXG4gIC8vIG9uIHRoZSBzdHlsZU5vZGUgb2JqZWN0IGxldmVsLCBhbmQgcmVjdXJzaXZlbHkgY2FsbHMgaXRzZWxmXG4gIC8vIGZvciBhbGwgbmVzdGVkIHN0eWxlIG9iamVjdHMuIEFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiwgdGhlXG4gIC8vIHN0eWxlTm9kZSBvYmplY3Qgd2lsbCBiZSBmdWxseSBwcm9jZXNzZWQsIGkuZS4sIGFsbCBzdHlsZXNcbiAgLy8gcmVxdWlyZWQgYnkgdGhpcyBvYmplY3QsIGFuZCBhbnkgb2YgaXRzIGNoaWxkcmVuIHdpbGwgYmUgcmVzb2x2ZWQuXG4gIGZ1bmN0aW9uIGluY2x1ZGVOb2RlU3R5bGVzKHN0eWxlTm9kZSwgcHJvY2Vzc2luZ1N0eWxlTmFtZXMpIHtcbiAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChzdHlsZU5vZGUpKSB7XG4gICAgICByZXR1cm4gc3R5bGVOb2RlO1xuICAgIH1cblxuICAgIC8vIFN0eWxlIG5hbWVzIHdoaWNoIGN1cnJlbnQgc3R5bGUgbm9kZSB3YW50IHRvIGluY2x1ZGVcbiAgICBjb25zdCBzdHlsZU5hbWVzVG9JbmNsdWRlID0gc3R5bGVOb2RlW0lOQ0xVREVdO1xuXG4gICAgbGV0IHN0eWxlc1RvSW5jbHVkZSA9IHt9O1xuICAgIGlmIChzdHlsZU5hbWVzVG9JbmNsdWRlKSB7XG4gICAgICBpZiAoIV8uaXNBcnJheShzdHlsZU5hbWVzVG9JbmNsdWRlKSkge1xuICAgICAgICB0aHJvdyBFcnJvcignSW5jbHVkZSBzaG91bGQgYmUgYXJyYXknKTtcbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBzdHlsZU5hbWUgb2Ygc3R5bGVOYW1lc1RvSW5jbHVkZSkge1xuICAgICAgICBpZiAocHJvY2Vzc2luZ1N0eWxlTmFtZXMuaGFzKHN0eWxlTmFtZSkpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihgQ2lyY3VsYXIgc3R5bGUgaW5jbHVkZSwgaW5jbHVkaW5nICR7c3R5bGVOYW1lfWApO1xuICAgICAgICB9XG4gICAgICAgIHByb2Nlc3NpbmdTdHlsZU5hbWVzLmFkZChzdHlsZU5hbWUpO1xuICAgICAgICBzdHlsZXNUb0luY2x1ZGUgPSBfLm1lcmdlV2l0aChcbiAgICAgICAgICB7fSxcbiAgICAgICAgICBzdHlsZXNUb0luY2x1ZGUsXG4gICAgICAgICAgaW5jbHVkZU5vZGVTdHlsZXMoZ2V0U3R5bGUoc3R5bGVOYW1lKSwgcHJvY2Vzc2luZ1N0eWxlTmFtZXMpLFxuICAgICAgICAgIGluY2x1ZGVTeW1ib2xNZXJnZUhhbmRsZXJcbiAgICAgICAgKTtcbiAgICAgICAgcHJvY2Vzc2luZ1N0eWxlTmFtZXMuZGVsZXRlKHN0eWxlTmFtZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0aW5nU3R5bGUgPSBfLm1lcmdlV2l0aCh7fSwgc3R5bGVzVG9JbmNsdWRlLCBzdHlsZU5vZGUsIGluY2x1ZGVTeW1ib2xNZXJnZUhhbmRsZXIpO1xuICAgIGRlbGV0ZSByZXN1bHRpbmdTdHlsZVtJTkNMVURFXTtcblxuICAgIGZvciAoY29uc3Qgc3R5bGVOYW1lIG9mIF8ua2V5cyhyZXN1bHRpbmdTdHlsZSkpIHtcbiAgICAgIHJlc3VsdGluZ1N0eWxlW3N0eWxlTmFtZV0gPVxuICAgICAgICBpbmNsdWRlTm9kZVN0eWxlcyhyZXN1bHRpbmdTdHlsZVtzdHlsZU5hbWVdLCBwcm9jZXNzaW5nU3R5bGVOYW1lcyk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRpbmdTdHlsZTtcbiAgfVxuXG4gIC8vIEEgdGhhdCBob2xkcyBhbGwgc3R5bGUgbmFtZXMgdGhhdCBhcmUgY3VycmVudGx5XG4gIC8vIGJlaW5nIHByb2Nlc3NlZC4gVGhpcyBpcyB1c2VkIHRvIGRldGVjdCBpbmNsdWRlXG4gIC8vIGN5Y2xlcy5cbiAgY29uc3QgcHJvY2Vzc2luZ1N0eWxlTmFtZXMgPSBuZXcgU2V0KCk7XG4gIHJldHVybiBpbmNsdWRlTm9kZVN0eWxlcyh0YXJnZXQsIHByb2Nlc3NpbmdTdHlsZU5hbWVzKTtcbn1cbiJdfQ==