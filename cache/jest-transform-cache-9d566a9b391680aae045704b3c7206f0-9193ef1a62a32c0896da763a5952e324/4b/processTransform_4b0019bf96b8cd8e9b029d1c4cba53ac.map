{"version":3,"sources":["processTransform.js"],"names":["MatrixMath","require","Platform","invariant","stringifySafe","processTransform","transform","__DEV__","_validateTransforms","OS","result","createIdentityMatrix","forEach","key","Object","keys","transformation","value","multiplyInto","_multiplyTransform","reusePerspectiveCommand","reuseRotateXCommand","_convertToRadians","reuseRotateYCommand","reuseRotateZCommand","reuseScaleCommand","reuseScaleXCommand","reuseScaleYCommand","reuseTranslate3dCommand","reuseTranslate2dCommand","reuseSkewXCommand","reuseSkewYCommand","Error","matrixMathFunction","args","matrixToApply","argsWithIdentity","concat","apply","floatValue","parseFloat","indexOf","Math","PI","length","_validateTransform","getValue","multivalueTransforms","Array","isArray","module","exports"],"mappings":"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","file":"processTransform.js","sourcesContent":["/**\n * Copyright (c) 2015-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n */\n\n'use strict';\n\nconst MatrixMath = require('MatrixMath');\nconst Platform = require('Platform');\n\nconst invariant = require('fbjs/lib/invariant');\nconst stringifySafe = require('stringifySafe');\n\n/**\n * Generate a transform matrix based on the provided transforms, and use that\n * within the style object instead.\n *\n * This allows us to provide an API that is similar to CSS, where transforms may\n * be applied in an arbitrary order, and yet have a universal, singular\n * interface to native code.\n */\nfunction processTransform(\n  transform: Array<Object>,\n): Array<Object> | Array<number> {\n  if (__DEV__) {\n    _validateTransforms(transform);\n  }\n\n  // Android & iOS implementations of transform property accept the list of\n  // transform properties as opposed to a transform Matrix. This is necessary\n  // to control transform property updates completely on the native thread.\n  if (Platform.OS === 'android' || Platform.OS === 'ios') {\n    return transform;\n  }\n\n  const result = MatrixMath.createIdentityMatrix();\n\n  transform.forEach(transformation => {\n    const key = Object.keys(transformation)[0];\n    const value = transformation[key];\n\n    switch (key) {\n      case 'matrix':\n        MatrixMath.multiplyInto(result, result, value);\n        break;\n      case 'perspective':\n        _multiplyTransform(result, MatrixMath.reusePerspectiveCommand, [value]);\n        break;\n      case 'rotateX':\n        _multiplyTransform(result, MatrixMath.reuseRotateXCommand, [\n          _convertToRadians(value),\n        ]);\n        break;\n      case 'rotateY':\n        _multiplyTransform(result, MatrixMath.reuseRotateYCommand, [\n          _convertToRadians(value),\n        ]);\n        break;\n      case 'rotate':\n      case 'rotateZ':\n        _multiplyTransform(result, MatrixMath.reuseRotateZCommand, [\n          _convertToRadians(value),\n        ]);\n        break;\n      case 'scale':\n        _multiplyTransform(result, MatrixMath.reuseScaleCommand, [value]);\n        break;\n      case 'scaleX':\n        _multiplyTransform(result, MatrixMath.reuseScaleXCommand, [value]);\n        break;\n      case 'scaleY':\n        _multiplyTransform(result, MatrixMath.reuseScaleYCommand, [value]);\n        break;\n      case 'translate':\n        _multiplyTransform(result, MatrixMath.reuseTranslate3dCommand, [\n          value[0],\n          value[1],\n          value[2] || 0,\n        ]);\n        break;\n      case 'translateX':\n        _multiplyTransform(result, MatrixMath.reuseTranslate2dCommand, [\n          value,\n          0,\n        ]);\n        break;\n      case 'translateY':\n        _multiplyTransform(result, MatrixMath.reuseTranslate2dCommand, [\n          0,\n          value,\n        ]);\n        break;\n      case 'skewX':\n        _multiplyTransform(result, MatrixMath.reuseSkewXCommand, [\n          _convertToRadians(value),\n        ]);\n        break;\n      case 'skewY':\n        _multiplyTransform(result, MatrixMath.reuseSkewYCommand, [\n          _convertToRadians(value),\n        ]);\n        break;\n      default:\n        throw new Error('Invalid transform name: ' + key);\n    }\n  });\n\n  return result;\n}\n\n/**\n * Performs a destructive operation on a transform matrix.\n */\nfunction _multiplyTransform(\n  result: Array<number>,\n  matrixMathFunction: Function,\n  args: Array<number>,\n): void {\n  const matrixToApply = MatrixMath.createIdentityMatrix();\n  const argsWithIdentity = [matrixToApply].concat(args);\n  matrixMathFunction.apply(this, argsWithIdentity);\n  MatrixMath.multiplyInto(result, result, matrixToApply);\n}\n\n/**\n * Parses a string like '0.5rad' or '60deg' into radians expressed in a float.\n * Note that validation on the string is done in `_validateTransform()`.\n */\nfunction _convertToRadians(value: string): number {\n  const floatValue = parseFloat(value);\n  return value.indexOf('rad') > -1 ? floatValue : (floatValue * Math.PI) / 180;\n}\n\nfunction _validateTransforms(transform: Array<Object>): void {\n  transform.forEach(transformation => {\n    const keys = Object.keys(transformation);\n    invariant(\n      keys.length === 1,\n      'You must specify exactly one property per transform object. Passed properties: %s',\n      stringifySafe(transformation),\n    );\n    const key = keys[0];\n    const value = transformation[key];\n    _validateTransform(key, value, transformation);\n  });\n}\n\nfunction _validateTransform(key, value, transformation) {\n  invariant(\n    !value.getValue,\n    'You passed an Animated.Value to a normal component. ' +\n      'You need to wrap that component in an Animated. For example, ' +\n      'replace <View /> by <Animated.View />.',\n  );\n\n  const multivalueTransforms = ['matrix', 'translate'];\n  if (multivalueTransforms.indexOf(key) !== -1) {\n    invariant(\n      Array.isArray(value),\n      'Transform with key of %s must have an array as the value: %s',\n      key,\n      stringifySafe(transformation),\n    );\n  }\n  switch (key) {\n    case 'matrix':\n      invariant(\n        value.length === 9 || value.length === 16,\n        'Matrix transform must have a length of 9 (2d) or 16 (3d). ' +\n          'Provided matrix has a length of %s: %s',\n        value.length,\n        stringifySafe(transformation),\n      );\n      break;\n    case 'translate':\n      invariant(\n        value.length === 2 || value.length === 3,\n        'Transform with key translate must be an array of length 2 or 3, found %s: %s',\n        value.length,\n        stringifySafe(transformation),\n      );\n      break;\n    case 'rotateX':\n    case 'rotateY':\n    case 'rotateZ':\n    case 'rotate':\n    case 'skewX':\n    case 'skewY':\n      invariant(\n        typeof value === 'string',\n        'Transform with key of \"%s\" must be a string: %s',\n        key,\n        stringifySafe(transformation),\n      );\n      invariant(\n        value.indexOf('deg') > -1 || value.indexOf('rad') > -1,\n        'Rotate transform must be expressed in degrees (deg) or radians ' +\n          '(rad): %s',\n        stringifySafe(transformation),\n      );\n      break;\n    case 'perspective':\n      invariant(\n        typeof value === 'number',\n        'Transform with key of \"%s\" must be a number: %s',\n        key,\n        stringifySafe(transformation),\n      );\n      invariant(\n        value !== 0,\n        'Transform with key of \"%s\" cannot be zero: %s',\n        key,\n        stringifySafe(transformation),\n      );\n      break;\n    case 'translateX':\n    case 'translateY':\n    case 'scale':\n    case 'scaleX':\n    case 'scaleY':\n      invariant(\n        typeof value === 'number',\n        'Transform with key of \"%s\" must be a number: %s',\n        key,\n        stringifySafe(transformation),\n      );\n      break;\n    default:\n      invariant(\n        false,\n        'Invalid transform %s: %s',\n        key,\n        stringifySafe(transformation),\n      );\n  }\n}\n\nmodule.exports = processTransform;\n"]}