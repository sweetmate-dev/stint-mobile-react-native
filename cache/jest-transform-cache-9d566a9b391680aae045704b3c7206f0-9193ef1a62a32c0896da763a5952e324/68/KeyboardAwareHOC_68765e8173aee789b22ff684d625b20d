5cef3d21303d27b70a138bf280946998
Object.defineProperty(exports, "__esModule", { value: true });var _slicedToArray = function () {function sliceIterator(arr, i) {var _arr = [];var _n = true;var _d = false;var _e = undefined;try {for (var _i = arr[typeof Symbol === 'function' ? Symbol.iterator : '@@iterator'](), _s; !(_n = (_s = _i.next()).done); _n = true) {_arr.push(_s.value);if (i && _arr.length === i) break;}} catch (err) {_d = true;_e = err;} finally {try {if (!_n && _i["return"]) _i["return"]();} finally {if (_d) throw _e;}}return _arr;}return function (arr, i) {if (Array.isArray(arr)) {return arr;} else if ((typeof Symbol === 'function' ? Symbol.iterator : '@@iterator') in Object(arr)) {return sliceIterator(arr, i);} else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _extends = Object.assign || function (target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i];for (var key in source) {if (Object.prototype.hasOwnProperty.call(source, key)) {target[key] = source[key];}}}return target;};var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();

var _react = require('react');var _react2 = _interopRequireDefault(_react);
var _propTypes = require('prop-types');var _propTypes2 = _interopRequireDefault(_propTypes);
var _reactNative = require('react-native');var _reactNative2 = _interopRequireDefault(_reactNative);






var _reactNativeIphoneXHelper = require('react-native-iphone-x-helper');function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self, call) {if (!self) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call && (typeof call === "object" || typeof call === "function") ? call : self;}function _inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;}



var _KAM_DEFAULT_TAB_BAR_HEIGHT = (0, _reactNativeIphoneXHelper.isIphoneX)() ? 83 : 49;
var _KAM_KEYBOARD_OPENING_TIME = 250;
var _KAM_EXTRA_HEIGHT = 75;















































function listenToKeyboardEvents(ScrollableComponent) {var _class, _temp, _initialiseProps;
  return _temp = _class = function (_React$Component) {_inherits(_class, _React$Component);







































    function _class(props) {_classCallCheck(this, _class);var _this = _possibleConstructorReturn(this, (_class.__proto__ || Object.getPrototypeOf(_class)).call(this,
      props));_initialiseProps.call(_this);
      _this.keyboardWillShowEvent = undefined;
      _this.keyboardWillHideEvent = undefined;
      _this.position = { x: 0, y: 0 };
      _this.defaultResetScrollToCoords = null;
      var keyboardSpace = props.viewIsInsideTabBar ?
      _KAM_DEFAULT_TAB_BAR_HEIGHT :
      0;
      _this.state = { keyboardSpace: keyboardSpace };return _this;
    }_createClass(_class, [{ key: 'componentDidMount', value: function componentDidMount()

      {
        this.mountedComponent = true;

        if (_reactNative.Platform.OS === 'ios') {
          this.keyboardWillShowEvent = _reactNative.Keyboard.addListener(
          'keyboardWillShow',
          this._updateKeyboardSpace);

          this.keyboardWillHideEvent = _reactNative.Keyboard.addListener(
          'keyboardWillHide',
          this._resetKeyboardSpace);

        } else if (_reactNative.Platform.OS === 'android' && this.props.enableOnAndroid) {
          this.keyboardWillShowEvent = _reactNative.Keyboard.addListener(
          'keyboardDidShow',
          this._updateKeyboardSpace);

          this.keyboardWillHideEvent = _reactNative.Keyboard.addListener(
          'keyboardDidHide',
          this._resetKeyboardSpace);

        }
      } }, { key: 'componentWillReceiveProps', value: function componentWillReceiveProps(

      nextProps) {
        if (nextProps.viewIsInsideTabBar !== this.props.viewIsInsideTabBar) {
          var _keyboardSpace = nextProps.viewIsInsideTabBar ?
          _KAM_DEFAULT_TAB_BAR_HEIGHT :
          0;
          if (this.state.keyboardSpace !== _keyboardSpace) {
            this.setState({ keyboardSpace: _keyboardSpace });
          }
        }
      } }, { key: 'componentWillUnmount', value: function componentWillUnmount()

      {
        this.mountedComponent = false;
        this.keyboardWillShowEvent && this.keyboardWillShowEvent.remove();
        this.keyboardWillHideEvent && this.keyboardWillHideEvent.remove();
      } }, { key: 'render', value: function render()



































































































































































































































      {var _props =
        this.props,enableOnAndroid = _props.enableOnAndroid,contentContainerStyle = _props.contentContainerStyle;
        var newContentContainerStyle = void 0;
        if (_reactNative.Platform.OS === 'android' && enableOnAndroid) {
          newContentContainerStyle = [].concat(contentContainerStyle).concat({
            paddingBottom:
            ((contentContainerStyle || {}).paddingBottom || 0) +
            this.state.keyboardSpace });

        }
        return (
          _react2.default.createElement(ScrollableComponent, _extends({
            ref: this._handleRef,
            keyboardDismissMode: 'interactive',
            contentInset: { bottom: this.state.keyboardSpace },
            automaticallyAdjustContentInsets: false,
            showsVerticalScrollIndicator: true,
            scrollEventThrottle: 1 },
          this.props, {
            contentContainerStyle:
            newContentContainerStyle || contentContainerStyle,

            keyboardSpace: this.state.keyboardSpace,
            getScrollResponder: this.getScrollResponder,
            scrollToPosition: this.scrollToPosition,
            scrollToEnd: this.scrollToEnd,
            scrollForExtraHeightOnAndroid: this.scrollForExtraHeightOnAndroid,
            scrollToFocusedInput: this.scrollToFocusedInput,
            resetKeyboardSpace: this._resetKeyboardSpace,
            handleOnScroll: this._handleOnScroll,
            onScroll: this._onScroll })));


      } }]);return _class;}(_react2.default.Component), _class.propTypes = { viewIsInsideTabBar: _propTypes2.default.bool, resetScrollToCoords: _propTypes2.default.shape({ x: _propTypes2.default.number.isRequired, y: _propTypes2.default.number.isRequired }), enableResetScrollToCoords: _propTypes2.default.bool, enableAutomaticScroll: _propTypes2.default.bool, extraHeight: _propTypes2.default.number, extraScrollHeight: _propTypes2.default.number, keyboardOpeningTime: _propTypes2.default.number, onScroll: _propTypes2.default.func, contentContainerStyle: _propTypes2.default.any, enableOnAndroid: _propTypes2.default.bool, innerRef: _propTypes2.default.func }, _class.defaultProps = { enableAutomaticScroll: true, extraHeight: _KAM_EXTRA_HEIGHT, extraScrollHeight: 0, enableResetScrollToCoords: true, keyboardOpeningTime: _KAM_KEYBOARD_OPENING_TIME, viewIsInsideTabBar: false }, _initialiseProps = function _initialiseProps() {var _this2 = this;this.getScrollResponder = function () {return _this2._rnkasv_keyboardView && _this2._rnkasv_keyboardView.getScrollResponder();};this.scrollToPosition = function (x, y) {var animated = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;var responder = _this2.getScrollResponder();responder && responder.scrollResponderScrollTo({ x: x, y: y, animated: animated });};this.scrollToEnd = function () {var animated = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;var responder = _this2.getScrollResponder();responder && responder.scrollResponderScrollToEnd({ animated: animated });};this.scrollForExtraHeightOnAndroid = function (extraHeight) {_this2.scrollToPosition(0, _this2.position.y + extraHeight, true);};this.scrollToFocusedInput = function (reactNode, extraHeight, keyboardOpeningTime) {if (extraHeight === undefined) {extraHeight = _this2.props.extraHeight || 0;}if (keyboardOpeningTime === undefined) {keyboardOpeningTime = _this2.props.keyboardOpeningTime || 0;}setTimeout(function () {if (!_this2.mountedComponent) {return;}var responder = _this2.getScrollResponder();responder && responder.scrollResponderScrollNativeHandleToKeyboard(reactNode, extraHeight, true);}, keyboardOpeningTime);};this.scrollIntoView = function _callee(element) {var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};var _ref, _ref2, parentLayout, childLayout, getScrollPosition, _getScrollPosition, x, y, animated;return regeneratorRuntime.async(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:if (!(!_this2._rnkasv_keyboardView || !element)) {_context.next = 2;break;}return _context.abrupt('return');case 2:_context.next = 4;return regeneratorRuntime.awrap(Promise.all([_this2._measureElement(_this2._rnkasv_keyboardView), _this2._measureElement(element)]));case 4:_ref = _context.sent;_ref2 = _slicedToArray(_ref, 2);parentLayout = _ref2[0];childLayout = _ref2[1];getScrollPosition = options.getScrollPosition || _this2._defaultGetScrollPosition;_getScrollPosition = getScrollPosition(parentLayout, childLayout, _this2.position), x = _getScrollPosition.x, y = _getScrollPosition.y, animated = _getScrollPosition.animated;_this2.scrollToPosition(x, y, animated);case 11:case 'end':return _context.stop();}}}, null, _this2);};this._defaultGetScrollPosition = function (parentLayout, childLayout, contentOffset) {return { x: 0, y: Math.max(0, childLayout.y - parentLayout.y + contentOffset.y), animated: true };};this._measureElement = function (element) {var node = (0, _reactNative.findNodeHandle)(element);return new Promise(function (resolve) {_reactNative.UIManager.measureInWindow(node, function (x, y, width, height) {resolve({ x: x, y: y, width: width, height: height });});});};this._updateKeyboardSpace = function (frames) {if (_this2.props.enableAutomaticScroll) {var _keyboardSpace2 = frames.endCoordinates.height + _this2.props.extraScrollHeight;if (_this2.props.viewIsInsideTabBar) {_keyboardSpace2 -= _KAM_DEFAULT_TAB_BAR_HEIGHT;}_this2.setState({ keyboardSpace: _keyboardSpace2 });var currentlyFocusedField = _reactNative.TextInput.State.currentlyFocusedField();var responder = _this2.getScrollResponder();if (!currentlyFocusedField || !responder) {return;}_reactNative.UIManager.viewIsDescendantOf(currentlyFocusedField, responder.getInnerViewNode(), function (isAncestor) {if (isAncestor) {_reactNative.UIManager.measureInWindow(currentlyFocusedField, function (x, y, width, height) {var textInputBottomPosition = y + height;var keyboardPosition = frames.endCoordinates.screenY;var totalExtraHeight = _this2.props.extraScrollHeight + _this2.props.extraHeight;if (_reactNative.Platform.OS === 'ios') {if (textInputBottomPosition > keyboardPosition - totalExtraHeight) {_this2._scrollToFocusedInputWithNodeHandle(currentlyFocusedField);}} else {if (textInputBottomPosition > keyboardPosition) {_keyboardSpace2 = _keyboardSpace2 - (textInputBottomPosition - keyboardPosition);_this2.setState({ keyboardSpace: _keyboardSpace2 });_this2.scrollForExtraHeightOnAndroid(totalExtraHeight);} else if (textInputBottomPosition > keyboardPosition - totalExtraHeight) {_this2.scrollForExtraHeightOnAndroid(totalExtraHeight - (keyboardPosition - textInputBottomPosition));}}});}});}if (!_this2.resetCoords) {if (!_this2.defaultResetScrollToCoords) {_this2.defaultResetScrollToCoords = _this2.position;}}};this._resetKeyboardSpace = function () {var keyboardSpace = _this2.props.viewIsInsideTabBar ? _KAM_DEFAULT_TAB_BAR_HEIGHT + _this2.props.extraScrollHeight || 0 : _this2.props.extraScrollHeight || 0;_this2.setState({ keyboardSpace: keyboardSpace });if (_this2.props.enableResetScrollToCoords === false) {_this2.defaultResetScrollToCoords = null;return;} else if (_this2.resetCoords) {_this2.scrollToPosition(_this2.resetCoords.x, _this2.resetCoords.y, true);} else {if (_this2.defaultResetScrollToCoords) {_this2.scrollToPosition(_this2.defaultResetScrollToCoords.x, _this2.defaultResetScrollToCoords.y, true);_this2.defaultResetScrollToCoords = null;} else {_this2.scrollToPosition(0, 0, true);}}};this._scrollToFocusedInputWithNodeHandle = function (nodeID, extraHeight, keyboardOpeningTime) {if (extraHeight === undefined) {extraHeight = _this2.props.extraHeight;}var reactNode = _reactNative2.default.findNodeHandle(nodeID);_this2.scrollToFocusedInput(reactNode, extraHeight + _this2.props.extraScrollHeight, keyboardOpeningTime !== undefined ? keyboardOpeningTime : _this2.props.keyboardOpeningTime || 0);};this._handleOnScroll = function (e) {_this2.position = e.nativeEvent.contentOffset;};this._handleRef = function (ref) {_this2._rnkasv_keyboardView = ref;if (_this2.props.innerRef) {_this2.props.innerRef(_this2._rnkasv_keyboardView);}};this._onScroll = function (e) {_this2._handleOnScroll(e);_this2.props.onScroll && _this2.props.onScroll(e);};}, _temp;

}exports.default =

listenToKeyboardEvents;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIktleWJvYXJkQXdhcmVIT0MuanMiXSwibmFtZXMiOlsiX0tBTV9ERUZBVUxUX1RBQl9CQVJfSEVJR0hUIiwiX0tBTV9LRVlCT0FSRF9PUEVOSU5HX1RJTUUiLCJfS0FNX0VYVFJBX0hFSUdIVCIsImxpc3RlblRvS2V5Ym9hcmRFdmVudHMiLCJTY3JvbGxhYmxlQ29tcG9uZW50IiwicHJvcHMiLCJrZXlib2FyZFdpbGxTaG93RXZlbnQiLCJ1bmRlZmluZWQiLCJrZXlib2FyZFdpbGxIaWRlRXZlbnQiLCJwb3NpdGlvbiIsIngiLCJ5IiwiZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHMiLCJrZXlib2FyZFNwYWNlIiwidmlld0lzSW5zaWRlVGFiQmFyIiwic3RhdGUiLCJtb3VudGVkQ29tcG9uZW50IiwiUGxhdGZvcm0iLCJPUyIsIktleWJvYXJkIiwiYWRkTGlzdGVuZXIiLCJfdXBkYXRlS2V5Ym9hcmRTcGFjZSIsIl9yZXNldEtleWJvYXJkU3BhY2UiLCJlbmFibGVPbkFuZHJvaWQiLCJuZXh0UHJvcHMiLCJzZXRTdGF0ZSIsInJlbW92ZSIsImNvbnRlbnRDb250YWluZXJTdHlsZSIsIm5ld0NvbnRlbnRDb250YWluZXJTdHlsZSIsImNvbmNhdCIsInBhZGRpbmdCb3R0b20iLCJfaGFuZGxlUmVmIiwiYm90dG9tIiwiZ2V0U2Nyb2xsUmVzcG9uZGVyIiwic2Nyb2xsVG9Qb3NpdGlvbiIsInNjcm9sbFRvRW5kIiwic2Nyb2xsRm9yRXh0cmFIZWlnaHRPbkFuZHJvaWQiLCJzY3JvbGxUb0ZvY3VzZWRJbnB1dCIsIl9oYW5kbGVPblNjcm9sbCIsIl9vblNjcm9sbCIsIlJlYWN0IiwiQ29tcG9uZW50IiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwiYm9vbCIsInJlc2V0U2Nyb2xsVG9Db29yZHMiLCJzaGFwZSIsIm51bWJlciIsImlzUmVxdWlyZWQiLCJlbmFibGVSZXNldFNjcm9sbFRvQ29vcmRzIiwiZW5hYmxlQXV0b21hdGljU2Nyb2xsIiwiZXh0cmFIZWlnaHQiLCJleHRyYVNjcm9sbEhlaWdodCIsImtleWJvYXJkT3BlbmluZ1RpbWUiLCJvblNjcm9sbCIsImZ1bmMiLCJhbnkiLCJpbm5lclJlZiIsImRlZmF1bHRQcm9wcyIsIl9ybmthc3Zfa2V5Ym9hcmRWaWV3IiwiYW5pbWF0ZWQiLCJyZXNwb25kZXIiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyIsInNjcm9sbFJlc3BvbmRlclNjcm9sbFRvRW5kIiwicmVhY3ROb2RlIiwic2V0VGltZW91dCIsInNjcm9sbFJlc3BvbmRlclNjcm9sbE5hdGl2ZUhhbmRsZVRvS2V5Ym9hcmQiLCJzY3JvbGxJbnRvVmlldyIsImVsZW1lbnQiLCJvcHRpb25zIiwiUHJvbWlzZSIsImFsbCIsIl9tZWFzdXJlRWxlbWVudCIsInBhcmVudExheW91dCIsImNoaWxkTGF5b3V0IiwiZ2V0U2Nyb2xsUG9zaXRpb24iLCJfZGVmYXVsdEdldFNjcm9sbFBvc2l0aW9uIiwiY29udGVudE9mZnNldCIsIk1hdGgiLCJtYXgiLCJub2RlIiwicmVzb2x2ZSIsIlVJTWFuYWdlciIsIm1lYXN1cmVJbldpbmRvdyIsIndpZHRoIiwiaGVpZ2h0IiwiZnJhbWVzIiwiZW5kQ29vcmRpbmF0ZXMiLCJjdXJyZW50bHlGb2N1c2VkRmllbGQiLCJUZXh0SW5wdXQiLCJTdGF0ZSIsInZpZXdJc0Rlc2NlbmRhbnRPZiIsImdldElubmVyVmlld05vZGUiLCJpc0FuY2VzdG9yIiwidGV4dElucHV0Qm90dG9tUG9zaXRpb24iLCJrZXlib2FyZFBvc2l0aW9uIiwic2NyZWVuWSIsInRvdGFsRXh0cmFIZWlnaHQiLCJfc2Nyb2xsVG9Gb2N1c2VkSW5wdXRXaXRoTm9kZUhhbmRsZSIsInJlc2V0Q29vcmRzIiwibm9kZUlEIiwiUmVhY3ROYXRpdmUiLCJmaW5kTm9kZUhhbmRsZSIsImUiLCJuYXRpdmVFdmVudCIsInJlZiJdLCJtYXBwaW5ncyI6Ijs7QUFFQSw4QjtBQUNBLHVDO0FBQ0EsMkM7Ozs7Ozs7QUFPQSx3RTs7OztBQUlBLElBQU1BLDhCQUFzQyw2Q0FB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LENBQWxCLENBQ0EsT0FBSy9ELG9CQUFMLENBQ0UyQixTQURGLEVBRUViLGNBQWMsT0FBSzlDLEtBQUwsQ0FBVytDLGlCQUYzQixFQUdFQyx3QkFBd0I5QyxTQUF4QixHQUNJOEMsbUJBREosR0FFSSxPQUFLaEQsS0FBTCxDQUFXZ0QsbUJBQVgsSUFBa0MsQ0FMeEMsRUFPRCxDQXpTSCxNQTJTRWYsZUEzU0YsR0EyU29CLFVBQ2hCaUUsQ0FEZ0IsRUFFYixDQUNILE9BQUs5RixRQUFMLEdBQWdCOEYsRUFBRUMsV0FBRixDQUFjM0IsYUFBOUIsQ0FDRCxDQS9TSCxNQWlURTlDLFVBalRGLEdBaVRlLFVBQUMwRSxHQUFELEVBQTZCLENBQ3hDLE9BQUs5QyxvQkFBTCxHQUE0QjhDLEdBQTVCLENBQ0EsSUFBSSxPQUFLcEcsS0FBTCxDQUFXb0QsUUFBZixFQUF5QixDQUN2QixPQUFLcEQsS0FBTCxDQUFXb0QsUUFBWCxDQUFvQixPQUFLRSxvQkFBekIsRUFDRCxDQUNGLENBdFRILE1Bd1RFcEIsU0F4VEYsR0F3VGMsVUFDVmdFLENBRFUsRUFFUCxDQUNILE9BQUtqRSxlQUFMLENBQXFCaUUsQ0FBckIsRUFDQSxPQUFLbEcsS0FBTCxDQUFXaUQsUUFBWCxJQUF1QixPQUFLakQsS0FBTCxDQUFXaUQsUUFBWCxDQUFvQmlELENBQXBCLENBQXZCLENBQ0QsQ0E3VEg7O0FBa1dELEM7O0FBRWNwRyxzQiIsImZpbGUiOiJLZXlib2FyZEF3YXJlSE9DLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IFJlYWN0TmF0aXZlLCB7XG4gIEtleWJvYXJkLFxuICBQbGF0Zm9ybSxcbiAgVUlNYW5hZ2VyLFxuICBUZXh0SW5wdXQsXG4gIGZpbmROb2RlSGFuZGxlXG59IGZyb20gJ3JlYWN0LW5hdGl2ZSdcbmltcG9ydCB7IGlzSXBob25lWCB9IGZyb20gJ3JlYWN0LW5hdGl2ZS1pcGhvbmUteC1oZWxwZXInXG5cbmltcG9ydCB0eXBlIHsgS2V5Ym9hcmRBd2FyZUludGVyZmFjZSB9IGZyb20gJy4vS2V5Ym9hcmRBd2FyZUludGVyZmFjZSdcblxuY29uc3QgX0tBTV9ERUZBVUxUX1RBQl9CQVJfSEVJR0hUOiBudW1iZXIgPSBpc0lwaG9uZVgoKSA/IDgzIDogNDlcbmNvbnN0IF9LQU1fS0VZQk9BUkRfT1BFTklOR19USU1FOiBudW1iZXIgPSAyNTBcbmNvbnN0IF9LQU1fRVhUUkFfSEVJR0hUOiBudW1iZXIgPSA3NVxuXG5leHBvcnQgdHlwZSBLZXlib2FyZEF3YXJlSE9DUHJvcHMgPSB7XG4gIHZpZXdJc0luc2lkZVRhYkJhcj86IGJvb2xlYW4sXG4gIHJlc2V0U2Nyb2xsVG9Db29yZHM/OiB7XG4gICAgeDogbnVtYmVyLFxuICAgIHk6IG51bWJlclxuICB9LFxuICBlbmFibGVSZXNldFNjcm9sbFRvQ29vcmRzPzogYm9vbGVhbixcbiAgZW5hYmxlQXV0b21hdGljU2Nyb2xsPzogYm9vbGVhbixcbiAgZXh0cmFIZWlnaHQ/OiBudW1iZXIsXG4gIGV4dHJhU2Nyb2xsSGVpZ2h0PzogbnVtYmVyLFxuICBrZXlib2FyZE9wZW5pbmdUaW1lPzogbnVtYmVyLFxuICBvblNjcm9sbD86IEZ1bmN0aW9uLFxuICBjb250ZW50Q29udGFpbmVyU3R5bGU/OiBhbnksXG4gIGVuYWJsZU9uQW5kcm9pZD86IGJvb2xlYW4sXG4gIGlubmVyUmVmPzogRnVuY3Rpb25cbn1cbmV4cG9ydCB0eXBlIEtleWJvYXJkQXdhcmVIT0NTdGF0ZSA9IHtcbiAga2V5Ym9hcmRTcGFjZTogbnVtYmVyXG59XG5cbmV4cG9ydCB0eXBlIEVsZW1lbnRMYXlvdXQgPSB7XG4gIHg6IG51bWJlcixcbiAgeTogbnVtYmVyLFxuICB3aWR0aDogbnVtYmVyLFxuICBoZWlnaHQ6IG51bWJlclxufVxuXG5leHBvcnQgdHlwZSBDb250ZW50T2Zmc2V0ID0ge1xuICB4OiBudW1iZXIsXG4gIHk6IG51bWJlclxufVxuXG5leHBvcnQgdHlwZSBTY3JvbGxQb3NpdGlvbiA9IHtcbiAgeDogbnVtYmVyLFxuICB5OiBudW1iZXIsXG4gIGFuaW1hdGVkOiBib29sZWFuXG59XG5cbmV4cG9ydCB0eXBlIFNjcm9sbEludG9WaWV3T3B0aW9ucyA9ID97XG4gIGdldFNjcm9sbFBvc2l0aW9uPzogKFxuICAgIHBhcmVudExheW91dDogRWxlbWVudExheW91dCxcbiAgICBjaGlsZExheW91dDogRWxlbWVudExheW91dCxcbiAgICBjb250ZW50T2Zmc2V0OiBDb250ZW50T2Zmc2V0XG4gICkgPT4gU2Nyb2xsUG9zaXRpb25cbn1cblxuZnVuY3Rpb24gbGlzdGVuVG9LZXlib2FyZEV2ZW50cyhTY3JvbGxhYmxlQ29tcG9uZW50OiBSZWFjdCRDb21wb25lbnQpIHtcbiAgcmV0dXJuIGNsYXNzIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFxuICAgIEtleWJvYXJkQXdhcmVIT0NQcm9wcyxcbiAgICBLZXlib2FyZEF3YXJlSE9DU3RhdGVcbiAgICA+IGltcGxlbWVudHMgS2V5Ym9hcmRBd2FyZUludGVyZmFjZSB7XG4gICAgX3Jua2Fzdl9rZXlib2FyZFZpZXc6IGFueVxuICAgIGtleWJvYXJkV2lsbFNob3dFdmVudDogP0Z1bmN0aW9uXG4gICAga2V5Ym9hcmRXaWxsSGlkZUV2ZW50OiA/RnVuY3Rpb25cbiAgICBwb3NpdGlvbjogQ29udGVudE9mZnNldFxuICAgIGRlZmF1bHRSZXNldFNjcm9sbFRvQ29vcmRzOiA/eyB4OiBudW1iZXIsIHk6IG51bWJlciB9XG4gICAgcmVzZXRDb29yZHM6ID97IHg6IG51bWJlciwgeTogbnVtYmVyIH1cbiAgICBtb3VudGVkQ29tcG9uZW50OiBib29sZWFuXG4gICAgaGFuZGxlT25TY3JvbGw6IEZ1bmN0aW9uXG4gICAgc3RhdGU6IEtleWJvYXJkQXdhcmVIT0NTdGF0ZVxuXG4gICAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAgIHZpZXdJc0luc2lkZVRhYkJhcjogUHJvcFR5cGVzLmJvb2wsXG4gICAgICByZXNldFNjcm9sbFRvQ29vcmRzOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICB4OiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gICAgICAgIHk6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZFxuICAgICAgfSksXG4gICAgICBlbmFibGVSZXNldFNjcm9sbFRvQ29vcmRzOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAgIGVuYWJsZUF1dG9tYXRpY1Njcm9sbDogUHJvcFR5cGVzLmJvb2wsXG4gICAgICBleHRyYUhlaWdodDogUHJvcFR5cGVzLm51bWJlcixcbiAgICAgIGV4dHJhU2Nyb2xsSGVpZ2h0OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgICAga2V5Ym9hcmRPcGVuaW5nVGltZTogUHJvcFR5cGVzLm51bWJlcixcbiAgICAgIG9uU2Nyb2xsOiBQcm9wVHlwZXMuZnVuYyxcbiAgICAgIGNvbnRlbnRDb250YWluZXJTdHlsZTogUHJvcFR5cGVzLmFueSxcbiAgICAgIGVuYWJsZU9uQW5kcm9pZDogUHJvcFR5cGVzLmJvb2wsXG4gICAgICBpbm5lclJlZjogUHJvcFR5cGVzLmZ1bmNcbiAgICB9XG5cbiAgICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgZW5hYmxlQXV0b21hdGljU2Nyb2xsOiB0cnVlLFxuICAgICAgZXh0cmFIZWlnaHQ6IF9LQU1fRVhUUkFfSEVJR0hULFxuICAgICAgZXh0cmFTY3JvbGxIZWlnaHQ6IDAsXG4gICAgICBlbmFibGVSZXNldFNjcm9sbFRvQ29vcmRzOiB0cnVlLFxuICAgICAga2V5Ym9hcmRPcGVuaW5nVGltZTogX0tBTV9LRVlCT0FSRF9PUEVOSU5HX1RJTUUsXG4gICAgICB2aWV3SXNJbnNpZGVUYWJCYXI6IGZhbHNlXG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IEtleWJvYXJkQXdhcmVIT0NQcm9wcykge1xuICAgICAgc3VwZXIocHJvcHMpXG4gICAgICB0aGlzLmtleWJvYXJkV2lsbFNob3dFdmVudCA9IHVuZGVmaW5lZFxuICAgICAgdGhpcy5rZXlib2FyZFdpbGxIaWRlRXZlbnQgPSB1bmRlZmluZWRcbiAgICAgIHRoaXMucG9zaXRpb24gPSB7IHg6IDAsIHk6IDAgfVxuICAgICAgdGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3JkcyA9IG51bGxcbiAgICAgIGNvbnN0IGtleWJvYXJkU3BhY2U6IG51bWJlciA9IHByb3BzLnZpZXdJc0luc2lkZVRhYkJhclxuICAgICAgICA/IF9LQU1fREVGQVVMVF9UQUJfQkFSX0hFSUdIVFxuICAgICAgICA6IDBcbiAgICAgIHRoaXMuc3RhdGUgPSB7IGtleWJvYXJkU3BhY2UgfVxuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgdGhpcy5tb3VudGVkQ29tcG9uZW50ID0gdHJ1ZVxuICAgICAgLy8gS2V5Ym9hcmQgZXZlbnRzXG4gICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICAgIHRoaXMua2V5Ym9hcmRXaWxsU2hvd0V2ZW50ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAgICAgJ2tleWJvYXJkV2lsbFNob3cnLFxuICAgICAgICAgIHRoaXMuX3VwZGF0ZUtleWJvYXJkU3BhY2VcbiAgICAgICAgKVxuICAgICAgICB0aGlzLmtleWJvYXJkV2lsbEhpZGVFdmVudCA9IEtleWJvYXJkLmFkZExpc3RlbmVyKFxuICAgICAgICAgICdrZXlib2FyZFdpbGxIaWRlJyxcbiAgICAgICAgICB0aGlzLl9yZXNldEtleWJvYXJkU3BhY2VcbiAgICAgICAgKVxuICAgICAgfSBlbHNlIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnICYmIHRoaXMucHJvcHMuZW5hYmxlT25BbmRyb2lkKSB7XG4gICAgICAgIHRoaXMua2V5Ym9hcmRXaWxsU2hvd0V2ZW50ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAgICAgJ2tleWJvYXJkRGlkU2hvdycsXG4gICAgICAgICAgdGhpcy5fdXBkYXRlS2V5Ym9hcmRTcGFjZVxuICAgICAgICApXG4gICAgICAgIHRoaXMua2V5Ym9hcmRXaWxsSGlkZUV2ZW50ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAgICAgJ2tleWJvYXJkRGlkSGlkZScsXG4gICAgICAgICAgdGhpcy5fcmVzZXRLZXlib2FyZFNwYWNlXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wczogS2V5Ym9hcmRBd2FyZUhPQ1Byb3BzKSB7XG4gICAgICBpZiAobmV4dFByb3BzLnZpZXdJc0luc2lkZVRhYkJhciAhPT0gdGhpcy5wcm9wcy52aWV3SXNJbnNpZGVUYWJCYXIpIHtcbiAgICAgICAgY29uc3Qga2V5Ym9hcmRTcGFjZTogbnVtYmVyID0gbmV4dFByb3BzLnZpZXdJc0luc2lkZVRhYkJhclxuICAgICAgICAgID8gX0tBTV9ERUZBVUxUX1RBQl9CQVJfSEVJR0hUXG4gICAgICAgICAgOiAwXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmtleWJvYXJkU3BhY2UgIT09IGtleWJvYXJkU3BhY2UpIHtcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHsga2V5Ym9hcmRTcGFjZSB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICB0aGlzLm1vdW50ZWRDb21wb25lbnQgPSBmYWxzZVxuICAgICAgdGhpcy5rZXlib2FyZFdpbGxTaG93RXZlbnQgJiYgdGhpcy5rZXlib2FyZFdpbGxTaG93RXZlbnQucmVtb3ZlKClcbiAgICAgIHRoaXMua2V5Ym9hcmRXaWxsSGlkZUV2ZW50ICYmIHRoaXMua2V5Ym9hcmRXaWxsSGlkZUV2ZW50LnJlbW92ZSgpXG4gICAgfVxuXG4gICAgZ2V0U2Nyb2xsUmVzcG9uZGVyID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgdGhpcy5fcm5rYXN2X2tleWJvYXJkVmlldyAmJlxuICAgICAgICB0aGlzLl9ybmthc3Zfa2V5Ym9hcmRWaWV3LmdldFNjcm9sbFJlc3BvbmRlcigpXG4gICAgICApXG4gICAgfVxuXG4gICAgc2Nyb2xsVG9Qb3NpdGlvbiA9ICh4OiBudW1iZXIsIHk6IG51bWJlciwgYW5pbWF0ZWQ6IGJvb2xlYW4gPSB0cnVlKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25kZXIgPSB0aGlzLmdldFNjcm9sbFJlc3BvbmRlcigpXG4gICAgICByZXNwb25kZXIgJiYgcmVzcG9uZGVyLnNjcm9sbFJlc3BvbmRlclNjcm9sbFRvKHsgeCwgeSwgYW5pbWF0ZWQgfSlcbiAgICB9XG5cbiAgICBzY3JvbGxUb0VuZCA9IChhbmltYXRlZD86IGJvb2xlYW4gPSB0cnVlKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25kZXIgPSB0aGlzLmdldFNjcm9sbFJlc3BvbmRlcigpXG4gICAgICByZXNwb25kZXIgJiYgcmVzcG9uZGVyLnNjcm9sbFJlc3BvbmRlclNjcm9sbFRvRW5kKHsgYW5pbWF0ZWQgfSlcbiAgICB9XG5cbiAgICBzY3JvbGxGb3JFeHRyYUhlaWdodE9uQW5kcm9pZCA9IChleHRyYUhlaWdodDogbnVtYmVyKSA9PiB7XG4gICAgICB0aGlzLnNjcm9sbFRvUG9zaXRpb24oMCwgdGhpcy5wb3NpdGlvbi55ICsgZXh0cmFIZWlnaHQsIHRydWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIGtleWJvYXJkT3BlbmluZ1RpbWU6IHRha2VzIGEgZGlmZmVyZW50IGtleWJvYXJkT3BlbmluZ1RpbWUgaW4gY29uc2lkZXJhdGlvbi5cbiAgICAgKiBAcGFyYW0gZXh0cmFIZWlnaHQ6IHRha2VzIGFuIGV4dHJhIGhlaWdodCBpbiBjb25zaWRlcmF0aW9uLlxuICAgICAqL1xuICAgIHNjcm9sbFRvRm9jdXNlZElucHV0ID0gKFxuICAgICAgcmVhY3ROb2RlOiBhbnksXG4gICAgICBleHRyYUhlaWdodD86IG51bWJlcixcbiAgICAgIGtleWJvYXJkT3BlbmluZ1RpbWU/OiBudW1iZXJcbiAgICApID0+IHtcbiAgICAgIGlmIChleHRyYUhlaWdodCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGV4dHJhSGVpZ2h0ID0gdGhpcy5wcm9wcy5leHRyYUhlaWdodCB8fCAwXG4gICAgICB9XG4gICAgICBpZiAoa2V5Ym9hcmRPcGVuaW5nVGltZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGtleWJvYXJkT3BlbmluZ1RpbWUgPSB0aGlzLnByb3BzLmtleWJvYXJkT3BlbmluZ1RpbWUgfHwgMFxuICAgICAgfVxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5tb3VudGVkQ29tcG9uZW50KSB7XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uZGVyID0gdGhpcy5nZXRTY3JvbGxSZXNwb25kZXIoKVxuICAgICAgICByZXNwb25kZXIgJiZcbiAgICAgICAgICByZXNwb25kZXIuc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsTmF0aXZlSGFuZGxlVG9LZXlib2FyZChcbiAgICAgICAgICAgIHJlYWN0Tm9kZSxcbiAgICAgICAgICAgIGV4dHJhSGVpZ2h0LFxuICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgIClcbiAgICAgIH0sIGtleWJvYXJkT3BlbmluZ1RpbWUpXG4gICAgfVxuXG4gICAgc2Nyb2xsSW50b1ZpZXcgPSBhc3luYyAoXG4gICAgICBlbGVtZW50OiBSZWFjdC5FbGVtZW50PCo+LFxuICAgICAgb3B0aW9uczogU2Nyb2xsSW50b1ZpZXdPcHRpb25zID0ge31cbiAgICApID0+IHtcbiAgICAgIGlmICghdGhpcy5fcm5rYXN2X2tleWJvYXJkVmlldyB8fCAhZWxlbWVudCkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgY29uc3QgW1xuICAgICAgICBwYXJlbnRMYXlvdXQsXG4gICAgICAgIGNoaWxkTGF5b3V0XG4gICAgICBdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICB0aGlzLl9tZWFzdXJlRWxlbWVudCh0aGlzLl9ybmthc3Zfa2V5Ym9hcmRWaWV3KSxcbiAgICAgICAgdGhpcy5fbWVhc3VyZUVsZW1lbnQoZWxlbWVudClcbiAgICAgIF0pXG5cbiAgICAgIGNvbnN0IGdldFNjcm9sbFBvc2l0aW9uID0gb3B0aW9ucy5nZXRTY3JvbGxQb3NpdGlvbiB8fCB0aGlzLl9kZWZhdWx0R2V0U2Nyb2xsUG9zaXRpb25cbiAgICAgIGNvbnN0IHsgeCwgeSwgYW5pbWF0ZWQgfSA9IGdldFNjcm9sbFBvc2l0aW9uKHBhcmVudExheW91dCwgY2hpbGRMYXlvdXQsIHRoaXMucG9zaXRpb24pXG4gICAgICB0aGlzLnNjcm9sbFRvUG9zaXRpb24oeCwgeSwgYW5pbWF0ZWQpXG4gICAgfVxuXG4gICAgX2RlZmF1bHRHZXRTY3JvbGxQb3NpdGlvbiA9IChcbiAgICAgIHBhcmVudExheW91dDogRWxlbWVudExheW91dCxcbiAgICAgIGNoaWxkTGF5b3V0OiBFbGVtZW50TGF5b3V0LFxuICAgICAgY29udGVudE9mZnNldDogQ29udGVudE9mZnNldFxuICAgICk6IFNjcm9sbFBvc2l0aW9uID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IDAsXG4gICAgICAgIHk6IE1hdGgubWF4KDAsIGNoaWxkTGF5b3V0LnkgLSBwYXJlbnRMYXlvdXQueSArIGNvbnRlbnRPZmZzZXQueSksXG4gICAgICAgIGFuaW1hdGVkOiB0cnVlLFxuICAgICAgfVxuICAgIH1cblxuICAgIF9tZWFzdXJlRWxlbWVudCA9IChlbGVtZW50OiBSZWFjdC5FbGVtZW50PCo+KTogUHJvbWlzZTxFbGVtZW50TGF5b3V0PiA9PiB7XG4gICAgICBjb25zdCBub2RlID0gZmluZE5vZGVIYW5kbGUoZWxlbWVudClcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZTogKEVsZW1lbnRMYXlvdXQpID0+IHZvaWQpID0+IHtcbiAgICAgICAgVUlNYW5hZ2VyLm1lYXN1cmVJbldpbmRvdyhub2RlLCAoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZSh7IHgsIHksIHdpZHRoLCBoZWlnaHQgfSlcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgLy8gS2V5Ym9hcmQgYWN0aW9uc1xuICAgIF91cGRhdGVLZXlib2FyZFNwYWNlID0gKGZyYW1lczogT2JqZWN0KSA9PiB7XG4gICAgICAvLyBBdXRvbWF0aWNhbGx5IHNjcm9sbCB0byBmb2N1c2VkIFRleHRJbnB1dFxuICAgICAgaWYgKHRoaXMucHJvcHMuZW5hYmxlQXV0b21hdGljU2Nyb2xsKSB7XG4gICAgICAgIGxldCBrZXlib2FyZFNwYWNlOiBudW1iZXIgPSBmcmFtZXMuZW5kQ29vcmRpbmF0ZXMuaGVpZ2h0ICsgdGhpcy5wcm9wcy5leHRyYVNjcm9sbEhlaWdodFxuICAgICAgICBpZiAodGhpcy5wcm9wcy52aWV3SXNJbnNpZGVUYWJCYXIpIHtcbiAgICAgICAgICBrZXlib2FyZFNwYWNlIC09IF9LQU1fREVGQVVMVF9UQUJfQkFSX0hFSUdIVFxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBrZXlib2FyZFNwYWNlIH0pXG4gICAgICAgIGNvbnN0IGN1cnJlbnRseUZvY3VzZWRGaWVsZCA9IFRleHRJbnB1dC5TdGF0ZS5jdXJyZW50bHlGb2N1c2VkRmllbGQoKVxuICAgICAgICBjb25zdCByZXNwb25kZXIgPSB0aGlzLmdldFNjcm9sbFJlc3BvbmRlcigpXG4gICAgICAgIGlmICghY3VycmVudGx5Rm9jdXNlZEZpZWxkIHx8ICFyZXNwb25kZXIpIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBVSU1hbmFnZXIudmlld0lzRGVzY2VuZGFudE9mKFxuICAgICAgICAgIGN1cnJlbnRseUZvY3VzZWRGaWVsZCxcbiAgICAgICAgICByZXNwb25kZXIuZ2V0SW5uZXJWaWV3Tm9kZSgpLFxuICAgICAgICAgIChpc0FuY2VzdG9yOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNBbmNlc3Rvcikge1xuICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgVGV4dElucHV0IHdpbGwgYmUgaGlkZGVuIGJ5IHRoZSBrZXlib2FyZFxuICAgICAgICAgICAgICBVSU1hbmFnZXIubWVhc3VyZUluV2luZG93KFxuICAgICAgICAgICAgICAgIGN1cnJlbnRseUZvY3VzZWRGaWVsZCxcbiAgICAgICAgICAgICAgICAoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0SW5wdXRCb3R0b21Qb3NpdGlvbiA9IHkgKyBoZWlnaHRcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGtleWJvYXJkUG9zaXRpb24gPSBmcmFtZXMuZW5kQ29vcmRpbmF0ZXMuc2NyZWVuWVxuICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxFeHRyYUhlaWdodCA9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuZXh0cmFTY3JvbGxIZWlnaHQgKyB0aGlzLnByb3BzLmV4dHJhSGVpZ2h0XG4gICAgICAgICAgICAgICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICB0ZXh0SW5wdXRCb3R0b21Qb3NpdGlvbiA+XG4gICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmRQb3NpdGlvbiAtIHRvdGFsRXh0cmFIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2Nyb2xsVG9Gb2N1c2VkSW5wdXRXaXRoTm9kZUhhbmRsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRseUZvY3VzZWRGaWVsZFxuICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT24gYW5kcm9pZCwgdGhlIHN5c3RlbSB3b3VsZCBzY3JvbGwgdGhlIHRleHQgaW5wdXQganVzdFxuICAgICAgICAgICAgICAgICAgICAvLyBhYm92ZSB0aGUga2V5Ym9hcmQgc28gd2UganVzdCBuZWV0IHRvIHNjcm9sbCB0aGUgZXh0cmFcbiAgICAgICAgICAgICAgICAgICAgLy8gaGVpZ2h0IHBhcnRcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHRJbnB1dEJvdHRvbVBvc2l0aW9uID4ga2V5Ym9hcmRQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgIC8vIFNpbmNlIHRoZSBzeXN0ZW0gYWxyZWFkeSBzY3JvbGxlZCB0aGUgd2hvbGUgdmlldyB1cFxuICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIHNob3VsZCByZWR1Y2UgdGhhdCBhbW91bnRcbiAgICAgICAgICAgICAgICAgICAgICBrZXlib2FyZFNwYWNlID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkU3BhY2UgLVxuICAgICAgICAgICAgICAgICAgICAgICAgKHRleHRJbnB1dEJvdHRvbVBvc2l0aW9uIC0ga2V5Ym9hcmRQb3NpdGlvbilcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsga2V5Ym9hcmRTcGFjZSB9KVxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsRm9yRXh0cmFIZWlnaHRPbkFuZHJvaWQodG90YWxFeHRyYUhlaWdodClcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICB0ZXh0SW5wdXRCb3R0b21Qb3NpdGlvbiA+XG4gICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmRQb3NpdGlvbiAtIHRvdGFsRXh0cmFIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxGb3JFeHRyYUhlaWdodE9uQW5kcm9pZChcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsRXh0cmFIZWlnaHQgLVxuICAgICAgICAgICAgICAgICAgICAgICAgICAoa2V5Ym9hcmRQb3NpdGlvbiAtIHRleHRJbnB1dEJvdHRvbVBvc2l0aW9uKVxuICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLnJlc2V0Q29vcmRzKSB7XG4gICAgICAgIGlmICghdGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3Jkcykge1xuICAgICAgICAgIHRoaXMuZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHMgPSB0aGlzLnBvc2l0aW9uXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBfcmVzZXRLZXlib2FyZFNwYWNlID0gKCkgPT4ge1xuICAgICAgY29uc3Qga2V5Ym9hcmRTcGFjZTogbnVtYmVyID0gdGhpcy5wcm9wcy52aWV3SXNJbnNpZGVUYWJCYXJcbiAgICAgICAgPyBfS0FNX0RFRkFVTFRfVEFCX0JBUl9IRUlHSFQgKyB0aGlzLnByb3BzLmV4dHJhU2Nyb2xsSGVpZ2h0IHx8IDBcbiAgICAgICAgOiB0aGlzLnByb3BzLmV4dHJhU2Nyb2xsSGVpZ2h0IHx8IDBcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBrZXlib2FyZFNwYWNlIH0pXG4gICAgICAvLyBSZXNldCBzY3JvbGwgcG9zaXRpb24gYWZ0ZXIga2V5Ym9hcmQgZGlzbWlzc2FsXG4gICAgICBpZiAodGhpcy5wcm9wcy5lbmFibGVSZXNldFNjcm9sbFRvQ29vcmRzID09PSBmYWxzZSkge1xuICAgICAgICB0aGlzLmRlZmF1bHRSZXNldFNjcm9sbFRvQ29vcmRzID0gbnVsbFxuICAgICAgICByZXR1cm5cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5yZXNldENvb3Jkcykge1xuICAgICAgICB0aGlzLnNjcm9sbFRvUG9zaXRpb24odGhpcy5yZXNldENvb3Jkcy54LCB0aGlzLnJlc2V0Q29vcmRzLnksIHRydWUpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3Jkcykge1xuICAgICAgICAgIHRoaXMuc2Nyb2xsVG9Qb3NpdGlvbihcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHMueCxcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHMueSxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICApXG4gICAgICAgICAgdGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3JkcyA9IG51bGxcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNjcm9sbFRvUG9zaXRpb24oMCwgMCwgdHJ1ZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIF9zY3JvbGxUb0ZvY3VzZWRJbnB1dFdpdGhOb2RlSGFuZGxlID0gKFxuICAgICAgbm9kZUlEOiBudW1iZXIsXG4gICAgICBleHRyYUhlaWdodD86IG51bWJlcixcbiAgICAgIGtleWJvYXJkT3BlbmluZ1RpbWU/OiBudW1iZXJcbiAgICApID0+IHtcbiAgICAgIGlmIChleHRyYUhlaWdodCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGV4dHJhSGVpZ2h0ID0gdGhpcy5wcm9wcy5leHRyYUhlaWdodFxuICAgICAgfVxuICAgICAgY29uc3QgcmVhY3ROb2RlID0gUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUobm9kZUlEKVxuICAgICAgdGhpcy5zY3JvbGxUb0ZvY3VzZWRJbnB1dChcbiAgICAgICAgcmVhY3ROb2RlLFxuICAgICAgICBleHRyYUhlaWdodCArIHRoaXMucHJvcHMuZXh0cmFTY3JvbGxIZWlnaHQsXG4gICAgICAgIGtleWJvYXJkT3BlbmluZ1RpbWUgIT09IHVuZGVmaW5lZFxuICAgICAgICAgID8ga2V5Ym9hcmRPcGVuaW5nVGltZVxuICAgICAgICAgIDogdGhpcy5wcm9wcy5rZXlib2FyZE9wZW5pbmdUaW1lIHx8IDBcbiAgICAgIClcbiAgICB9XG5cbiAgICBfaGFuZGxlT25TY3JvbGwgPSAoXG4gICAgICBlOiBTeW50aGV0aWNFdmVudDwqPiAmIHsgbmF0aXZlRXZlbnQ6IHsgY29udGVudE9mZnNldDogbnVtYmVyIH0gfVxuICAgICkgPT4ge1xuICAgICAgdGhpcy5wb3NpdGlvbiA9IGUubmF0aXZlRXZlbnQuY29udGVudE9mZnNldFxuICAgIH1cblxuICAgIF9oYW5kbGVSZWYgPSAocmVmOiBSZWFjdC5Db21wb25lbnQ8Kj4pID0+IHtcbiAgICAgIHRoaXMuX3Jua2Fzdl9rZXlib2FyZFZpZXcgPSByZWZcbiAgICAgIGlmICh0aGlzLnByb3BzLmlubmVyUmVmKSB7XG4gICAgICAgIHRoaXMucHJvcHMuaW5uZXJSZWYodGhpcy5fcm5rYXN2X2tleWJvYXJkVmlldylcbiAgICAgIH1cbiAgICB9XG5cbiAgICBfb25TY3JvbGwgPSAoXG4gICAgICBlOiBTeW50aGV0aWNFdmVudDwqPiAmIHsgbmF0aXZlRXZlbnQ6IHsgY29udGVudE9mZnNldDogbnVtYmVyIH0gfVxuICAgICkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlT25TY3JvbGwoZSlcbiAgICAgIHRoaXMucHJvcHMub25TY3JvbGwgJiYgdGhpcy5wcm9wcy5vblNjcm9sbChlKVxuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgIGNvbnN0IHsgZW5hYmxlT25BbmRyb2lkLCBjb250ZW50Q29udGFpbmVyU3R5bGUgfSA9IHRoaXMucHJvcHNcbiAgICAgIGxldCBuZXdDb250ZW50Q29udGFpbmVyU3R5bGVcbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnICYmIGVuYWJsZU9uQW5kcm9pZCkge1xuICAgICAgICBuZXdDb250ZW50Q29udGFpbmVyU3R5bGUgPSBbXS5jb25jYXQoY29udGVudENvbnRhaW5lclN0eWxlKS5jb25jYXQoe1xuICAgICAgICAgIHBhZGRpbmdCb3R0b206XG4gICAgICAgICAgICAoKGNvbnRlbnRDb250YWluZXJTdHlsZSB8fCB7fSkucGFkZGluZ0JvdHRvbSB8fCAwKSArXG4gICAgICAgICAgICB0aGlzLnN0YXRlLmtleWJvYXJkU3BhY2VcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxTY3JvbGxhYmxlQ29tcG9uZW50XG4gICAgICAgICAgcmVmPXt0aGlzLl9oYW5kbGVSZWZ9XG4gICAgICAgICAga2V5Ym9hcmREaXNtaXNzTW9kZT0naW50ZXJhY3RpdmUnXG4gICAgICAgICAgY29udGVudEluc2V0PXt7IGJvdHRvbTogdGhpcy5zdGF0ZS5rZXlib2FyZFNwYWNlIH19XG4gICAgICAgICAgYXV0b21hdGljYWxseUFkanVzdENvbnRlbnRJbnNldHM9e2ZhbHNlfVxuICAgICAgICAgIHNob3dzVmVydGljYWxTY3JvbGxJbmRpY2F0b3I9e3RydWV9XG4gICAgICAgICAgc2Nyb2xsRXZlbnRUaHJvdHRsZT17MX1cbiAgICAgICAgICB7Li4udGhpcy5wcm9wc31cbiAgICAgICAgICBjb250ZW50Q29udGFpbmVyU3R5bGU9e1xuICAgICAgICAgICAgbmV3Q29udGVudENvbnRhaW5lclN0eWxlIHx8IGNvbnRlbnRDb250YWluZXJTdHlsZVxuICAgICAgICAgIH1cbiAgICAgICAgICBrZXlib2FyZFNwYWNlPXt0aGlzLnN0YXRlLmtleWJvYXJkU3BhY2V9XG4gICAgICAgICAgZ2V0U2Nyb2xsUmVzcG9uZGVyPXt0aGlzLmdldFNjcm9sbFJlc3BvbmRlcn1cbiAgICAgICAgICBzY3JvbGxUb1Bvc2l0aW9uPXt0aGlzLnNjcm9sbFRvUG9zaXRpb259XG4gICAgICAgICAgc2Nyb2xsVG9FbmQ9e3RoaXMuc2Nyb2xsVG9FbmR9XG4gICAgICAgICAgc2Nyb2xsRm9yRXh0cmFIZWlnaHRPbkFuZHJvaWQ9e3RoaXMuc2Nyb2xsRm9yRXh0cmFIZWlnaHRPbkFuZHJvaWR9XG4gICAgICAgICAgc2Nyb2xsVG9Gb2N1c2VkSW5wdXQ9e3RoaXMuc2Nyb2xsVG9Gb2N1c2VkSW5wdXR9XG4gICAgICAgICAgcmVzZXRLZXlib2FyZFNwYWNlPXt0aGlzLl9yZXNldEtleWJvYXJkU3BhY2V9XG4gICAgICAgICAgaGFuZGxlT25TY3JvbGw9e3RoaXMuX2hhbmRsZU9uU2Nyb2xsfVxuICAgICAgICAgIG9uU2Nyb2xsPXt0aGlzLl9vblNjcm9sbH1cbiAgICAgICAgLz5cbiAgICAgIClcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgbGlzdGVuVG9LZXlib2FyZEV2ZW50c1xuIl19