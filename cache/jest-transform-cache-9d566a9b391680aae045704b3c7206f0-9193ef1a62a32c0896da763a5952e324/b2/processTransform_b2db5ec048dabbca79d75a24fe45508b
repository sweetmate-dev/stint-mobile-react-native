8d5cc5d4214b12dd9a01a4dde660ba47










'use strict';

var MatrixMath = require('MatrixMath');
var Platform = require('Platform');

var invariant = require('fbjs/lib/invariant');
var stringifySafe = require('stringifySafe');









function processTransform(
transform)
{
  if (__DEV__) {
    _validateTransforms(transform);
  }




  if (Platform.OS === 'android' || Platform.OS === 'ios') {
    return transform;
  }

  var result = MatrixMath.createIdentityMatrix();

  transform.forEach(function (transformation) {
    var key = Object.keys(transformation)[0];
    var value = transformation[key];

    switch (key) {
      case 'matrix':
        MatrixMath.multiplyInto(result, result, value);
        break;
      case 'perspective':
        _multiplyTransform(result, MatrixMath.reusePerspectiveCommand, [value]);
        break;
      case 'rotateX':
        _multiplyTransform(result, MatrixMath.reuseRotateXCommand, [
        _convertToRadians(value)]);

        break;
      case 'rotateY':
        _multiplyTransform(result, MatrixMath.reuseRotateYCommand, [
        _convertToRadians(value)]);

        break;
      case 'rotate':
      case 'rotateZ':
        _multiplyTransform(result, MatrixMath.reuseRotateZCommand, [
        _convertToRadians(value)]);

        break;
      case 'scale':
        _multiplyTransform(result, MatrixMath.reuseScaleCommand, [value]);
        break;
      case 'scaleX':
        _multiplyTransform(result, MatrixMath.reuseScaleXCommand, [value]);
        break;
      case 'scaleY':
        _multiplyTransform(result, MatrixMath.reuseScaleYCommand, [value]);
        break;
      case 'translate':
        _multiplyTransform(result, MatrixMath.reuseTranslate3dCommand, [
        value[0],
        value[1],
        value[2] || 0]);

        break;
      case 'translateX':
        _multiplyTransform(result, MatrixMath.reuseTranslate2dCommand, [
        value,
        0]);

        break;
      case 'translateY':
        _multiplyTransform(result, MatrixMath.reuseTranslate2dCommand, [
        0,
        value]);

        break;
      case 'skewX':
        _multiplyTransform(result, MatrixMath.reuseSkewXCommand, [
        _convertToRadians(value)]);

        break;
      case 'skewY':
        _multiplyTransform(result, MatrixMath.reuseSkewYCommand, [
        _convertToRadians(value)]);

        break;
      default:
        throw new Error('Invalid transform name: ' + key);}

  });

  return result;
}




function _multiplyTransform(
result,
matrixMathFunction,
args)
{
  var matrixToApply = MatrixMath.createIdentityMatrix();
  var argsWithIdentity = [matrixToApply].concat(args);
  matrixMathFunction.apply(this, argsWithIdentity);
  MatrixMath.multiplyInto(result, result, matrixToApply);
}





function _convertToRadians(value) {
  var floatValue = parseFloat(value);
  return value.indexOf('rad') > -1 ? floatValue : floatValue * Math.PI / 180;
}

function _validateTransforms(transform) {
  transform.forEach(function (transformation) {
    var keys = Object.keys(transformation);
    invariant(
    keys.length === 1,
    'You must specify exactly one property per transform object. Passed properties: %s',
    stringifySafe(transformation));

    var key = keys[0];
    var value = transformation[key];
    _validateTransform(key, value, transformation);
  });
}

function _validateTransform(key, value, transformation) {
  invariant(
  !value.getValue,
  'You passed an Animated.Value to a normal component. ' +
  'You need to wrap that component in an Animated. For example, ' +
  'replace <View /> by <Animated.View />.');


  var multivalueTransforms = ['matrix', 'translate'];
  if (multivalueTransforms.indexOf(key) !== -1) {
    invariant(
    Array.isArray(value),
    'Transform with key of %s must have an array as the value: %s',
    key,
    stringifySafe(transformation));

  }
  switch (key) {
    case 'matrix':
      invariant(
      value.length === 9 || value.length === 16,
      'Matrix transform must have a length of 9 (2d) or 16 (3d). ' +
      'Provided matrix has a length of %s: %s',
      value.length,
      stringifySafe(transformation));

      break;
    case 'translate':
      invariant(
      value.length === 2 || value.length === 3,
      'Transform with key translate must be an array of length 2 or 3, found %s: %s',
      value.length,
      stringifySafe(transformation));

      break;
    case 'rotateX':
    case 'rotateY':
    case 'rotateZ':
    case 'rotate':
    case 'skewX':
    case 'skewY':
      invariant(
      typeof value === 'string',
      'Transform with key of "%s" must be a string: %s',
      key,
      stringifySafe(transformation));

      invariant(
      value.indexOf('deg') > -1 || value.indexOf('rad') > -1,
      'Rotate transform must be expressed in degrees (deg) or radians ' +
      '(rad): %s',
      stringifySafe(transformation));

      break;
    case 'perspective':
      invariant(
      typeof value === 'number',
      'Transform with key of "%s" must be a number: %s',
      key,
      stringifySafe(transformation));

      invariant(
      value !== 0,
      'Transform with key of "%s" cannot be zero: %s',
      key,
      stringifySafe(transformation));

      break;
    case 'translateX':
    case 'translateY':
    case 'scale':
    case 'scaleX':
    case 'scaleY':
      invariant(
      typeof value === 'number',
      'Transform with key of "%s" must be a number: %s',
      key,
      stringifySafe(transformation));

      break;
    default:
      invariant(
      false,
      'Invalid transform %s: %s',
      key,
      stringifySafe(transformation));}


}

module.exports = processTransform;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2Nlc3NUcmFuc2Zvcm0uanMiXSwibmFtZXMiOlsiTWF0cml4TWF0aCIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsImludmFyaWFudCIsInN0cmluZ2lmeVNhZmUiLCJwcm9jZXNzVHJhbnNmb3JtIiwidHJhbnNmb3JtIiwiX19ERVZfXyIsIl92YWxpZGF0ZVRyYW5zZm9ybXMiLCJPUyIsInJlc3VsdCIsImNyZWF0ZUlkZW50aXR5TWF0cml4IiwiZm9yRWFjaCIsImtleSIsIk9iamVjdCIsImtleXMiLCJ0cmFuc2Zvcm1hdGlvbiIsInZhbHVlIiwibXVsdGlwbHlJbnRvIiwiX211bHRpcGx5VHJhbnNmb3JtIiwicmV1c2VQZXJzcGVjdGl2ZUNvbW1hbmQiLCJyZXVzZVJvdGF0ZVhDb21tYW5kIiwiX2NvbnZlcnRUb1JhZGlhbnMiLCJyZXVzZVJvdGF0ZVlDb21tYW5kIiwicmV1c2VSb3RhdGVaQ29tbWFuZCIsInJldXNlU2NhbGVDb21tYW5kIiwicmV1c2VTY2FsZVhDb21tYW5kIiwicmV1c2VTY2FsZVlDb21tYW5kIiwicmV1c2VUcmFuc2xhdGUzZENvbW1hbmQiLCJyZXVzZVRyYW5zbGF0ZTJkQ29tbWFuZCIsInJldXNlU2tld1hDb21tYW5kIiwicmV1c2VTa2V3WUNvbW1hbmQiLCJFcnJvciIsIm1hdHJpeE1hdGhGdW5jdGlvbiIsImFyZ3MiLCJtYXRyaXhUb0FwcGx5IiwiYXJnc1dpdGhJZGVudGl0eSIsImNvbmNhdCIsImFwcGx5IiwiZmxvYXRWYWx1ZSIsInBhcnNlRmxvYXQiLCJpbmRleE9mIiwiTWF0aCIsIlBJIiwibGVuZ3RoIiwiX3ZhbGlkYXRlVHJhbnNmb3JtIiwiZ2V0VmFsdWUiLCJtdWx0aXZhbHVlVHJhbnNmb3JtcyIsIkFycmF5IiwiaXNBcnJheSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFVQTs7QUFFQSxJQUFNQSxhQUFhQyxRQUFRLFlBQVIsQ0FBbkI7QUFDQSxJQUFNQyxXQUFXRCxRQUFRLFVB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b0JBQWNZLGNBQWQsQ0FKRjs7QUFNQWI7QUFDRWMsZ0JBQVUsQ0FEWjtBQUVFLHFEQUZGO0FBR0VKLFNBSEY7QUFJRVQsb0JBQWNZLGNBQWQsQ0FKRjs7QUFNQTtBQUNGLFNBQUssWUFBTDtBQUNBLFNBQUssWUFBTDtBQUNBLFNBQUssT0FBTDtBQUNBLFNBQUssUUFBTDtBQUNBLFNBQUssUUFBTDtBQUNFYjtBQUNFLGFBQU9jLEtBQVAsS0FBaUIsUUFEbkI7QUFFRSx1REFGRjtBQUdFSixTQUhGO0FBSUVULG9CQUFjWSxjQUFkLENBSkY7O0FBTUE7QUFDRjtBQUNFYjtBQUNFLFdBREY7QUFFRSxnQ0FGRjtBQUdFVSxTQUhGO0FBSUVULG9CQUFjWSxjQUFkLENBSkYsRUFoRUo7OztBQXVFRDs7QUFFRGtDLE9BQU9DLE9BQVAsR0FBaUI5QyxnQkFBakIiLCJmaWxlIjoicHJvY2Vzc1RyYW5zZm9ybS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQGZsb3dcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IE1hdHJpeE1hdGggPSByZXF1aXJlKCdNYXRyaXhNYXRoJyk7XG5jb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoJ1BsYXRmb3JtJyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuY29uc3Qgc3RyaW5naWZ5U2FmZSA9IHJlcXVpcmUoJ3N0cmluZ2lmeVNhZmUnKTtcblxuLyoqXG4gKiBHZW5lcmF0ZSBhIHRyYW5zZm9ybSBtYXRyaXggYmFzZWQgb24gdGhlIHByb3ZpZGVkIHRyYW5zZm9ybXMsIGFuZCB1c2UgdGhhdFxuICogd2l0aGluIHRoZSBzdHlsZSBvYmplY3QgaW5zdGVhZC5cbiAqXG4gKiBUaGlzIGFsbG93cyB1cyB0byBwcm92aWRlIGFuIEFQSSB0aGF0IGlzIHNpbWlsYXIgdG8gQ1NTLCB3aGVyZSB0cmFuc2Zvcm1zIG1heVxuICogYmUgYXBwbGllZCBpbiBhbiBhcmJpdHJhcnkgb3JkZXIsIGFuZCB5ZXQgaGF2ZSBhIHVuaXZlcnNhbCwgc2luZ3VsYXJcbiAqIGludGVyZmFjZSB0byBuYXRpdmUgY29kZS5cbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc1RyYW5zZm9ybShcbiAgdHJhbnNmb3JtOiBBcnJheTxPYmplY3Q+LFxuKTogQXJyYXk8T2JqZWN0PiB8IEFycmF5PG51bWJlcj4ge1xuICBpZiAoX19ERVZfXykge1xuICAgIF92YWxpZGF0ZVRyYW5zZm9ybXModHJhbnNmb3JtKTtcbiAgfVxuXG4gIC8vIEFuZHJvaWQgJiBpT1MgaW1wbGVtZW50YXRpb25zIG9mIHRyYW5zZm9ybSBwcm9wZXJ0eSBhY2NlcHQgdGhlIGxpc3Qgb2ZcbiAgLy8gdHJhbnNmb3JtIHByb3BlcnRpZXMgYXMgb3Bwb3NlZCB0byBhIHRyYW5zZm9ybSBNYXRyaXguIFRoaXMgaXMgbmVjZXNzYXJ5XG4gIC8vIHRvIGNvbnRyb2wgdHJhbnNmb3JtIHByb3BlcnR5IHVwZGF0ZXMgY29tcGxldGVseSBvbiB0aGUgbmF0aXZlIHRocmVhZC5cbiAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcgfHwgUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgcmV0dXJuIHRyYW5zZm9ybTtcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdCA9IE1hdHJpeE1hdGguY3JlYXRlSWRlbnRpdHlNYXRyaXgoKTtcblxuICB0cmFuc2Zvcm0uZm9yRWFjaCh0cmFuc2Zvcm1hdGlvbiA9PiB7XG4gICAgY29uc3Qga2V5ID0gT2JqZWN0LmtleXModHJhbnNmb3JtYXRpb24pWzBdO1xuICAgIGNvbnN0IHZhbHVlID0gdHJhbnNmb3JtYXRpb25ba2V5XTtcblxuICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICBjYXNlICdtYXRyaXgnOlxuICAgICAgICBNYXRyaXhNYXRoLm11bHRpcGx5SW50byhyZXN1bHQsIHJlc3VsdCwgdmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3BlcnNwZWN0aXZlJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVBlcnNwZWN0aXZlQ29tbWFuZCwgW3ZhbHVlXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncm90YXRlWCc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VSb3RhdGVYQ29tbWFuZCwgW1xuICAgICAgICAgIF9jb252ZXJ0VG9SYWRpYW5zKHZhbHVlKSxcbiAgICAgICAgXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncm90YXRlWSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VSb3RhdGVZQ29tbWFuZCwgW1xuICAgICAgICAgIF9jb252ZXJ0VG9SYWRpYW5zKHZhbHVlKSxcbiAgICAgICAgXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncm90YXRlJzpcbiAgICAgIGNhc2UgJ3JvdGF0ZVonOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlUm90YXRlWkNvbW1hbmQsIFtcbiAgICAgICAgICBfY29udmVydFRvUmFkaWFucyh2YWx1ZSksXG4gICAgICAgIF0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NjYWxlJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVNjYWxlQ29tbWFuZCwgW3ZhbHVlXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2NhbGVYJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVNjYWxlWENvbW1hbmQsIFt2YWx1ZV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NjYWxlWSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VTY2FsZVlDb21tYW5kLCBbdmFsdWVdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0cmFuc2xhdGUnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlVHJhbnNsYXRlM2RDb21tYW5kLCBbXG4gICAgICAgICAgdmFsdWVbMF0sXG4gICAgICAgICAgdmFsdWVbMV0sXG4gICAgICAgICAgdmFsdWVbMl0gfHwgMCxcbiAgICAgICAgXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndHJhbnNsYXRlWCc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VUcmFuc2xhdGUyZENvbW1hbmQsIFtcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAwLFxuICAgICAgICBdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0cmFuc2xhdGVZJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVRyYW5zbGF0ZTJkQ29tbWFuZCwgW1xuICAgICAgICAgIDAsXG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgIF0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NrZXdYJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVNrZXdYQ29tbWFuZCwgW1xuICAgICAgICAgIF9jb252ZXJ0VG9SYWRpYW5zKHZhbHVlKSxcbiAgICAgICAgXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2tld1knOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2tld1lDb21tYW5kLCBbXG4gICAgICAgICAgX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpLFxuICAgICAgICBdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdHJhbnNmb3JtIG5hbWU6ICcgKyBrZXkpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBQZXJmb3JtcyBhIGRlc3RydWN0aXZlIG9wZXJhdGlvbiBvbiBhIHRyYW5zZm9ybSBtYXRyaXguXG4gKi9cbmZ1bmN0aW9uIF9tdWx0aXBseVRyYW5zZm9ybShcbiAgcmVzdWx0OiBBcnJheTxudW1iZXI+LFxuICBtYXRyaXhNYXRoRnVuY3Rpb246IEZ1bmN0aW9uLFxuICBhcmdzOiBBcnJheTxudW1iZXI+LFxuKTogdm9pZCB7XG4gIGNvbnN0IG1hdHJpeFRvQXBwbHkgPSBNYXRyaXhNYXRoLmNyZWF0ZUlkZW50aXR5TWF0cml4KCk7XG4gIGNvbnN0IGFyZ3NXaXRoSWRlbnRpdHkgPSBbbWF0cml4VG9BcHBseV0uY29uY2F0KGFyZ3MpO1xuICBtYXRyaXhNYXRoRnVuY3Rpb24uYXBwbHkodGhpcywgYXJnc1dpdGhJZGVudGl0eSk7XG4gIE1hdHJpeE1hdGgubXVsdGlwbHlJbnRvKHJlc3VsdCwgcmVzdWx0LCBtYXRyaXhUb0FwcGx5KTtcbn1cblxuLyoqXG4gKiBQYXJzZXMgYSBzdHJpbmcgbGlrZSAnMC41cmFkJyBvciAnNjBkZWcnIGludG8gcmFkaWFucyBleHByZXNzZWQgaW4gYSBmbG9hdC5cbiAqIE5vdGUgdGhhdCB2YWxpZGF0aW9uIG9uIHRoZSBzdHJpbmcgaXMgZG9uZSBpbiBgX3ZhbGlkYXRlVHJhbnNmb3JtKClgLlxuICovXG5mdW5jdGlvbiBfY29udmVydFRvUmFkaWFucyh2YWx1ZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgZmxvYXRWYWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICByZXR1cm4gdmFsdWUuaW5kZXhPZigncmFkJykgPiAtMSA/IGZsb2F0VmFsdWUgOiAoZmxvYXRWYWx1ZSAqIE1hdGguUEkpIC8gMTgwO1xufVxuXG5mdW5jdGlvbiBfdmFsaWRhdGVUcmFuc2Zvcm1zKHRyYW5zZm9ybTogQXJyYXk8T2JqZWN0Pik6IHZvaWQge1xuICB0cmFuc2Zvcm0uZm9yRWFjaCh0cmFuc2Zvcm1hdGlvbiA9PiB7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRyYW5zZm9ybWF0aW9uKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBrZXlzLmxlbmd0aCA9PT0gMSxcbiAgICAgICdZb3UgbXVzdCBzcGVjaWZ5IGV4YWN0bHkgb25lIHByb3BlcnR5IHBlciB0cmFuc2Zvcm0gb2JqZWN0LiBQYXNzZWQgcHJvcGVydGllczogJXMnLFxuICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgKTtcbiAgICBjb25zdCBrZXkgPSBrZXlzWzBdO1xuICAgIGNvbnN0IHZhbHVlID0gdHJhbnNmb3JtYXRpb25ba2V5XTtcbiAgICBfdmFsaWRhdGVUcmFuc2Zvcm0oa2V5LCB2YWx1ZSwgdHJhbnNmb3JtYXRpb24pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gX3ZhbGlkYXRlVHJhbnNmb3JtKGtleSwgdmFsdWUsIHRyYW5zZm9ybWF0aW9uKSB7XG4gIGludmFyaWFudChcbiAgICAhdmFsdWUuZ2V0VmFsdWUsXG4gICAgJ1lvdSBwYXNzZWQgYW4gQW5pbWF0ZWQuVmFsdWUgdG8gYSBub3JtYWwgY29tcG9uZW50LiAnICtcbiAgICAgICdZb3UgbmVlZCB0byB3cmFwIHRoYXQgY29tcG9uZW50IGluIGFuIEFuaW1hdGVkLiBGb3IgZXhhbXBsZSwgJyArXG4gICAgICAncmVwbGFjZSA8VmlldyAvPiBieSA8QW5pbWF0ZWQuVmlldyAvPi4nLFxuICApO1xuXG4gIGNvbnN0IG11bHRpdmFsdWVUcmFuc2Zvcm1zID0gWydtYXRyaXgnLCAndHJhbnNsYXRlJ107XG4gIGlmIChtdWx0aXZhbHVlVHJhbnNmb3Jtcy5pbmRleE9mKGtleSkgIT09IC0xKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgQXJyYXkuaXNBcnJheSh2YWx1ZSksXG4gICAgICAnVHJhbnNmb3JtIHdpdGgga2V5IG9mICVzIG11c3QgaGF2ZSBhbiBhcnJheSBhcyB0aGUgdmFsdWU6ICVzJyxcbiAgICAgIGtleSxcbiAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICk7XG4gIH1cbiAgc3dpdGNoIChrZXkpIHtcbiAgICBjYXNlICdtYXRyaXgnOlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICB2YWx1ZS5sZW5ndGggPT09IDkgfHwgdmFsdWUubGVuZ3RoID09PSAxNixcbiAgICAgICAgJ01hdHJpeCB0cmFuc2Zvcm0gbXVzdCBoYXZlIGEgbGVuZ3RoIG9mIDkgKDJkKSBvciAxNiAoM2QpLiAnICtcbiAgICAgICAgICAnUHJvdmlkZWQgbWF0cml4IGhhcyBhIGxlbmd0aCBvZiAlczogJXMnLFxuICAgICAgICB2YWx1ZS5sZW5ndGgsXG4gICAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3RyYW5zbGF0ZSc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHZhbHVlLmxlbmd0aCA9PT0gMiB8fCB2YWx1ZS5sZW5ndGggPT09IDMsXG4gICAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgdHJhbnNsYXRlIG11c3QgYmUgYW4gYXJyYXkgb2YgbGVuZ3RoIDIgb3IgMywgZm91bmQgJXM6ICVzJyxcbiAgICAgICAgdmFsdWUubGVuZ3RoLFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdyb3RhdGVYJzpcbiAgICBjYXNlICdyb3RhdGVZJzpcbiAgICBjYXNlICdyb3RhdGVaJzpcbiAgICBjYXNlICdyb3RhdGUnOlxuICAgIGNhc2UgJ3NrZXdYJzpcbiAgICBjYXNlICdza2V3WSc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycsXG4gICAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgXCIlc1wiIG11c3QgYmUgYSBzdHJpbmc6ICVzJyxcbiAgICAgICAga2V5LFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHZhbHVlLmluZGV4T2YoJ2RlZycpID4gLTEgfHwgdmFsdWUuaW5kZXhPZigncmFkJykgPiAtMSxcbiAgICAgICAgJ1JvdGF0ZSB0cmFuc2Zvcm0gbXVzdCBiZSBleHByZXNzZWQgaW4gZGVncmVlcyAoZGVnKSBvciByYWRpYW5zICcgK1xuICAgICAgICAgICcocmFkKTogJXMnLFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdwZXJzcGVjdGl2ZSc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicsXG4gICAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgXCIlc1wiIG11c3QgYmUgYSBudW1iZXI6ICVzJyxcbiAgICAgICAga2V5LFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHZhbHVlICE9PSAwLFxuICAgICAgICAnVHJhbnNmb3JtIHdpdGgga2V5IG9mIFwiJXNcIiBjYW5ub3QgYmUgemVybzogJXMnLFxuICAgICAgICBrZXksXG4gICAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3RyYW5zbGF0ZVgnOlxuICAgIGNhc2UgJ3RyYW5zbGF0ZVknOlxuICAgIGNhc2UgJ3NjYWxlJzpcbiAgICBjYXNlICdzY2FsZVgnOlxuICAgIGNhc2UgJ3NjYWxlWSc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicsXG4gICAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgXCIlc1wiIG11c3QgYmUgYSBudW1iZXI6ICVzJyxcbiAgICAgICAga2V5LFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgJ0ludmFsaWQgdHJhbnNmb3JtICVzOiAlcycsXG4gICAgICAgIGtleSxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gcHJvY2Vzc1RyYW5zZm9ybTtcbiJdfQ==